(()=>{"use strict";const e="#12b212",t="#0a650a",n="#1a85ff",s="#ffc20a",o="#ffffff",i="#666666",r="#000000",a=window.location.search.includes("debug"),l=e=>e[Math.floor(Math.random()*e.length)],c=(e=512)=>{const t=document.createElement("canvas");t.width=e,t.height=e;const n=t.getContext("2d");return[t,n]},{StandardMaterial:h,Texture:d}=BABYLON;let p=0;const u=(e=!0,t)=>{const[n,s]=c(512);s.fillStyle="#c5a296",s.fillRect(0,0,n.width,n.height);s.save(),s.strokeStyle=r,s.lineWidth=4;const a=["#dd7d7d","#cb6b6b","#b65454","#9e3333","#842020"];for(let e=0;16*e<n.height;e++)for(let t=0;32*t<n.width;t++){s.fillStyle=l(a);const o=e%2?0:-16;s.fillRect(32*t+o,16*e,31,15),0===t&&s.fillRect(32*t+n.width+o,16*e,31,15)}return s.restore(),e&&(s.fillStyle=i,s.fillRect(192,128,128,256),s.strokeStyle=o,s.lineWidth=16,s.strokeRect(192,128,128,256),s.beginPath(),s.moveTo(256,128),s.lineTo(256,384),s.moveTo(192,224),s.lineTo(320,224),s.stroke()),m(n,t)},B=(e,t)=>{const n=new h("billboardMaterial"+ ++p,t);return n.diffuseColor=BABYLON.Color3.FromHexString(e),n},m=(e,t)=>{const n=new h("material"+ ++p,t),s=d.LoadFromDataString("texture"+ ++p,e.toDataURL(),t);return s.hasAlpha=!0,n.diffuseTexture=s,n},g=(e,t)=>{const[n,o]=c(512);o.fillStyle=s,o.fillRect(0,0,n.width,n.height),o.fillStyle=r;const a=n.width/e.length;return o.font=`${a}px Helvetica`,o.scale(1,n.height/a),o.textBaseline="middle",o.textAlign="center",e.forEach(((e,t)=>{o.strokeStyle=i,o.strokeRect(t*a,0,(t+1)*a,a),o.fillText(`${e}`,t*a+.5*a,.5*a)})),m(n,t)},w={},{TransformNode:b,Vector3:v}=BABYLON;class f{constructor(e){this.solved=!1,this.scene=e,this.parent=new b("Castle",this.scene),this.reset()}get model(){return this.parent}set position(e){this.parent.position=e}set scale(e){this.parent.scaling=e}isSolved(){return this.solved}reset(){[[-11.5,3,5,5,6,6],[-5.5,5,4,7,10,4],[0,5,3,4,10,6],[1.5,3,-3,9,6,6],[10.5,2.5,-4,9,5,4],[13.5,1,2,3,2,8],[14,2,7.5,4,4,3],[18.5,1.5,7.5,5,3,3],[22.5,1.5,8,3,3,4],[25,1,7.5,2,2,3],[22.5,1,1.5,3,2,9],[19.5,1,-4.5,9,2,3],[-5,12,4,8,4,2],[0,12,3,2,4,6],[6,3,7,12,6,4]].forEach(((e,t)=>{const[n,s,o,i,r,a]=e,l=BABYLON.MeshBuilder.CreateTiledBox(`castle-wall${t}`,{width:i,height:r,depth:a,tileSize:2},this.scene);l.position=new v(n,s,o),l.material=u(!0,this.scene),l.checkCollisions=!0,l.setParent(this.parent)})),[[-14,3.5,10,4,7,5],[-14,6,2,1,2,2],[-13.5,6.5,6,.5,1.5,0],[-13.5,6.5,4,.5,1.5,0],[-11.5,6.5,2.5,.5,1.5,0],[-9,10,2,2,3,4],[-9,14,4,1,2,1],[-9,10,6,2,3,4],[-6.5,11.5,2.5,1,3,3],[-3,5,2,4,10,0],[-2,12,3,2,3,1],[-2,10,0,2,3,4],[0,14,0,1,2,1],[2,10,0,2,3,4],[-3,6,-6,1,2,1],[-2.5,7,-3,.5,2,0],[0,7,-5.5,.5,2,0],[3,7,-5.5,.5,2,0],[6,3,-6,4,6,4],[15,5,-6,1,2,2],[21,3,10,1,2,2],[24,1.5,10,2,3,3]].forEach(((e,t)=>{const[n,s,o,i,r,a]=e,l=BABYLON.MeshBuilder.CreateCylinder(`turret${t}`,{height:r,diameter:i},this.scene);if(l.position=new v(n,s,o),l.material=u(!1,this.scene),l.checkCollisions=!0,l.setParent(this.parent),a){const e=BABYLON.MeshBuilder.CreateCylinder(`turret${t}`,{height:a,diameterBottom:1.1*i,diameterTop:0},this.scene);e.position=new v(n,s+.5*(r+a),o),e.setParent(this.parent)}}))}}class O{constructor(){this.animations=[],this.scene=null}static get Instance(){return O._instance||(O._instance=new O),O._instance}initScene(e){this.scene||(this.scene=e,this.scene.registerBeforeRender((()=>{const e=Date.now();this.animations=this.animations.filter((t=>{const n=(s=(e-t.startTime)/(t.endTime-t.startTime),0,1,Math.min(Math.max(s,0),1));var s;return e>=t.endTime?(t.end.position&&(t.mesh.position=t.end.position),t.end.rotation&&(t.mesh.rotation=t.end.rotation),t.end.scaling&&(t.mesh.scaling=t.end.scaling),!1):(t.end.position&&(t.mesh.position=BABYLON.Vector3.Lerp(t.start.position,t.end.position,t.easeFunc.ease(n))),t.end.rotation&&(t.mesh.rotation=BABYLON.Vector3.Lerp(t.start.rotation,t.end.rotation,t.easeFunc.ease(n))),t.end.scaling&&(t.mesh.scaling=BABYLON.Vector3.Lerp(t.start.scaling,t.end.scaling,t.easeFunc.ease(n))),!0)}))})))}animateTransform(e){const{mesh:t,end:n}=e,s=e.duration||1e3,o=e.delay||0,i=e.ease||new BABYLON.QuadraticEase,r=Date.now();this.animations.push({mesh:t,start:{position:t.position,rotation:t.rotation,scaling:t.scaling},end:n,easeFunc:i,startTime:r+o,endTime:r+o+s})}}function T(...e){return I.play(...e)}const I={volume:.3,sampleRate:44100,x:new(window.AudioContext||webkitAudioContext),play:function(...e){return this.playSamples(this.buildSamples(...e))},playSamples:function(...e){const t=this.x.createBuffer(e.length,e[0].length,this.sampleRate),n=this.x.createBufferSource();return e.map(((e,n)=>t.getChannelData(n).set(e))),n.buffer=t,n.connect(this.x.destination),n.start(),n},buildSamples:function(e=1,t=.05,n=220,s=0,o=0,i=.1,r=0,a=1,l=0,c=0,h=0,d=0,p=0,u=0,B=0,m=0,g=0,w=1,b=0,v=0){const f=2*Math.PI;let O,T,I=this.sampleRate,A=l*=500*f/I/I,L=n*=(1+2*t*Math.random()-t)*f/I,N=[],M=0,y=0,S=0,Y=1,x=0,k=0,C=0;for(c*=500*f/I**3,B*=f/I,h*=f/I,d*=I,p=p*I|0,T=(s=s*I+9)+(b*=I)+(o*=I)+(i*=I)+(g*=I)|0;S<T;N[S++]=C)++k%(100*m|0)||(C=r?r>1?r>2?r>3?Math.sin((M%f)**3):Math.max(Math.min(Math.tan(M),1),-1):1-(2*M/f%2+2)%2:1-4*Math.abs(Math.round(M/f)-M/f):Math.sin(M),C=(p?1-v+v*Math.sin(f*S/p):1)*(C>0?1:-1)*Math.abs(C)**a*e*this.volume*(S<s?S/s:S<s+b?1-(S-s)/b*(1-w):S<s+b+o?w:S<T-g?(T-S-g)/i*w:0),C=g?C/2+(g>S?0:(S<T-g?1:(T-S)/g)*N[S-g|0]/2):C),O=(n+=l+=c)*Math.cos(B*y++),M+=O-O*u*(1-1e9*(Math.sin(S)+1)%2),Y&&++Y>d&&(n+=h,L+=h,Y=0),!p||++x%p||(n=L,l=A,Y=Y||1);return N},getNote:function(e=0,t=440){return t*2**(e/12)}},A=()=>T(...[2.07,0,130.81,.01,.26,.47,3,1.15,,.1,,,.05,,,,.14,.26,.15,.02]),{TransformNode:L,MeshBuilder:N,Vector3:M}=BABYLON;let y=0;class S{constructor(e){this.setLines=e=>{this.billboard.material=((e,t)=>{const n=e.join("");if(w[n])return w[n];const[o,i]=c(512);if(i.fillStyle=s,i.fillRect(0,0,o.width,o.height),i.fillStyle=r,i.font="64px Helvetica",i.scale(1,3),i.textBaseline="top",i.textAlign="left",e.length>0){const t=28672/i.measureText(e[0]).width;i.font=`${t}px Helvetica`}e.forEach(((e,t)=>{i.fillText(`${e}`,32,32+72*t)}));const a=m(o,t);return w[n]=a,a})(e,this.scene)},this.scene=e,this.parent=new L("InfoBillboard"+ ++y,e),this.billboard=N.CreatePlane("billboard",{width:3,height:1,sideOrientation:BABYLON.Mesh.DOUBLESIDE},e),this.billboard.setParent(this.parent),this.billboard.position=new M(0,.6,0),this.billboard.rotation.x=Math.PI/4}set position(e){this.parent.position=e}get model(){return this.parent}}const Y=function(e){const t=BABYLON.Color3.FromHexString(e.color1||"#ff0000"),n=BABYLON.Color3.FromHexString(e.color2||"#0000ff"),s=e.scale||1,o=new BABYLON.NodeMaterial("node");o.mode=BABYLON.NodeMaterialModes.Material;const i=new BABYLON.InputBlock("position");i.visibleInInspector=!1,i.visibleOnFrame=!1,i.target=1,i.setAsAttribute("position");const r=new BABYLON.TransformBlock("WorldPos");r.visibleInInspector=!1,r.visibleOnFrame=!1,r.target=1,r.complementZ=0,r.complementW=1;const a=new BABYLON.InputBlock("World");a.visibleInInspector=!1,a.visibleOnFrame=!1,a.target=1,a.setAsSystemValue(BABYLON.NodeMaterialSystemValues.World);const l=new BABYLON.TransformBlock("World normal");l.visibleInInspector=!1,l.visibleOnFrame=!1,l.target=1,l.complementZ=0,l.complementW=0;const c=new BABYLON.InputBlock("normal");c.visibleInInspector=!1,c.visibleOnFrame=!1,c.target=1,c.setAsAttribute("normal");const h=new BABYLON.LightBlock("Lights");h.visibleInInspector=!1,h.visibleOnFrame=!1,h.target=3;const d=new BABYLON.InputBlock("cameraPosition");d.visibleInInspector=!1,d.visibleOnFrame=!1,d.target=1,d.setAsSystemValue(BABYLON.NodeMaterialSystemValues.CameraPosition);const p=new BABYLON.MultiplyBlock("Multiply");p.visibleInInspector=!1,p.visibleOnFrame=!1,p.target=4;const u=new BABYLON.GradientBlock("Gradient");u.visibleInInspector=!1,u.visibleOnFrame=!1,u.target=4,u.colorSteps=[],u.colorSteps.push(new BABYLON.GradientBlockColorStep(0,t)),u.colorSteps.push(new BABYLON.GradientBlockColorStep(1,n));const B=new BABYLON.SimplexPerlin3DBlock("SimplexPerlin3D");B.visibleInInspector=!1,B.visibleOnFrame=!1,B.target=4;const m=new BABYLON.ScaleBlock("Scale");m.visibleInInspector=!1,m.visibleOnFrame=!1,m.target=4;const g=new BABYLON.InputBlock("Scale");g.visibleInInspector=!1,g.visibleOnFrame=!1,g.target=1,g.value=s,g.min=0,g.max=0,g.isBoolean=!1,g.matrixMode=0,g.animationType=BABYLON.AnimatedInputBlockTypes.None,g.isConstant=!0;const w=new BABYLON.FragmentOutputBlock("FragmentOutput");w.visibleInInspector=!1,w.visibleOnFrame=!1,w.target=2,w.convertToGammaSpace=!1,w.convertToLinearSpace=!1,w.useLogarithmicDepth=!1;const b=new BABYLON.TransformBlock("WorldPos * ViewProjectionTransform");b.visibleInInspector=!1,b.visibleOnFrame=!1,b.target=1,b.complementZ=0,b.complementW=1;const v=new BABYLON.InputBlock("ViewProjection");v.visibleInInspector=!1,v.visibleOnFrame=!1,v.target=1,v.setAsSystemValue(BABYLON.NodeMaterialSystemValues.ViewProjection);const f=new BABYLON.VertexOutputBlock("VertexOutput");return f.visibleInInspector=!1,f.visibleOnFrame=!1,f.target=1,i.output.connectTo(r.vector),a.output.connectTo(r.transform),r.output.connectTo(b.vector),v.output.connectTo(b.transform),b.output.connectTo(f.vector),r.output.connectTo(h.worldPosition),c.output.connectTo(l.vector),a.output.connectTo(l.transform),l.output.connectTo(h.worldNormal),d.output.connectTo(h.cameraPosition),h.diffuseOutput.connectTo(p.left),r.xyz.connectTo(m.input),g.output.connectTo(m.factor),m.output.connectTo(B.seed),B.output.connectTo(u.gradient),u.output.connectTo(p.right),p.output.connectTo(w.rgb),o.addOutputNode(f),o.addOutputNode(w),o.build(),o},{TransformNode:x,Vector3:k}=BABYLON;let C=0;const P=["Red cannot be next to","another Red"],E=["Number of flowers must be one","more or less than neighbor"],F=["Square must be placed","in a square shape"];class R{constructor(t,s){this.meshes=[],this.colors={R:"#dc3220",G:e,B:n,Y:"#fefe62",W:o,D:"#994f00"},this.solved=!1,this.scene=s,this.board=t.board,this.solvedEvent=t.solvedEvent,this.boardHeight=this.board.length,this.boardWidth=this.board[0].length,this.parent=new x("FlowerBoxPuzzle",this.scene),this.inventoryTransform=new x("Holding",this.scene);const i=s.getNodeByName("inventory-parent");this.inventoryTransform.setParent(i),this.inventoryTransform.position=k.Zero(),this.inventoryTransform.rotation=k.Zero(),this.selectedMesh=null,this.messageBoard=new S(this.scene),this.messageBoard.setLines([]),this.messageBoard.model.setParent(this.parent),this.messageBoard.model.position=new k(.5*this.boardWidth,0,.5),this.reset()}get model(){return this.parent}set position(e){this.parent.position=e}set scale(e){this.parent.scaling=e}cellAt(e,t,n){try{const s=this.board[t][e];return n&&(this.board[t][e]=n),s}catch{return null}}boardPos(e,t){return new k(1*e+.5,0,-1*t-.5)}groupedCellCount(e,t){const n=[`${e},${t}`],s=this.cellAt(e,t);let o=0;for(let e=0;e<n.length;e++){const[t,i]=n[e].split(","),r=parseInt(t),a=parseInt(i);if(this.cellAt(r,a)===s){o+=1;const e=[`${r+1},${a}`,`${r-1},${a}`,`${r},${a+1}`,`${r},${a-1}`];n.push(...e.filter((e=>!n.includes(e))))}}return o}isSolved(){if(this.solved)return!0;let e=!1;if(this.selectedMesh&&"D"!==this.selectedMesh.metadata.color&&(a&&console.log("RULE - No flowers in hand"),this.messageBoard.setLines([]),e=!0),e)return;let t=0;const n=[];let s=Number.MAX_SAFE_INTEGER,o=-1,i=Number.MAX_SAFE_INTEGER,r=-1;return this.board.forEach(((l,c)=>{e||l.forEach(((l,h)=>{if(e)return;const[d,p,u]=l.split(""),B=[this.cellAt(h+1,c),this.cellAt(h-1,c),this.cellAt(h,c+1),this.cellAt(h,c-1)];"R"===p&&B.some((e=>"R"===e?.split("")[1]))&&(a&&console.log("RULE - Red cannot be next to another Red"),this.messageBoard.setLines(P),e=!0),e||(parseInt(d)>0&&(B.every((e=>{if(!e)return!0;const[t,n,s]=e?.split("");return 0===parseInt(t)||parseInt(d)===parseInt(t)-1||parseInt(d)===parseInt(t)+1}))||(a&&console.log("RULE - Adjacent cells must be 1 or -1 flowers"),this.messageBoard.setLines(E),e=!0)),"C"===u&&(t+=1,s=Math.min(s,h),o=Math.max(o,h),i=Math.min(i,c),r=Math.max(r,c),n.push({x:h,y:c})))}))})),t>0&&t<4&&(a&&console.log("RULE - Cube must have 4 points"),e=!0),n.every(((e,t)=>!(e.x!==s&&e.x!==o||e.y!==i&&e.y!==r)))||(a&&console.log(JSON.stringify(F)),this.messageBoard.setLines(F),e=!0),e||(this.solved=!0),this.solved&&(A(),this.messageBoard.setLines(["COMPLETE"]),this.solvedEvent&&this.solvedEvent()),this.solved}swapMesh(e){const t=e.metadata||{},{x:n,y:s}=t,o=this.selectedMesh?`${this.selectedMesh.metadata.count}${this.selectedMesh.metadata.color}${this.selectedMesh.metadata.shape}`:"";this.cellAt(n,s,o),this.selectedMesh&&(this.selectedMesh.metadata={...this.selectedMesh.metadata,picked:!1,x:n,y:s},this.placeFlower(this.selectedMesh),this.selectedMesh=null),e.metadata={...e.metadata,picked:!0},this.selectedMesh=e,this.placeFlower(this.selectedMesh),this.isSolved()}createFlower(t,n,s,o,i){const r=new BABYLON.Mesh("flower",this.scene);r.metadata={count:t,color:n,shape:s,x:o,y:i},r.onPointerPick=()=>{T(...[1.01,,275,.01,.01,.15,1,1.03,-3.7,,-93,.07,,,,-.1,,.5,.04,.09]),this.solved||this.swapMesh(r)};for(let o=0;o<t;o++){const i=BABYLON.MeshBuilder.CreateCylinder("stem"+ ++C,{height:.4,diameter:.1},this.scene);let a;i.setParent(r),i.position.y=.2,a="T"===s?BABYLON.MeshBuilder.CreateCylinder("head"+ ++C,{diameterBottom:0,diameterTop:.4,height:.4,tessellation:3},this.scene):"S"===s?BABYLON.MeshBuilder.CreateSphere("head"+ ++C,{diameter:.3},this.scene):BABYLON.MeshBuilder.CreateBox("head"+ ++C,{size:.25},this.scene),a.setParent(i),a.position=new k(0,.3,0),a.material=B(this.colors[n],this.scene),i.position=new k(0,.2,0),t>1&&i.rotateAround(k.Zero(),k.Right(),Math.PI/8),i.rotateAround(k.Zero(),k.Up(),2*o*Math.PI/t),i.material=B(e,this.scene)}const a=BABYLON.MeshBuilder.CreateCylinder("leaf",{diameter:.3,height:.1},this.scene);return a.setParent(r),a.position=new k(.15,.15,0),a.material=B(e,this.scene),r}createBush(){const n=new BABYLON.Mesh("bush",this.scene),s=BABYLON.MeshBuilder.CreateBox("head",{height:.2,width:.9,depth:.9},this.scene);return s.setParent(n),s.position=new k(0,.1,0),s.material=Y({color1:e,color2:t,scale:100}),n}createEmpty(e,t){const n=new BABYLON.Mesh("empty",this.scene);n.onPointerPick=()=>{this.solved||this.swapMesh(n)},n.metadata={count:1,color:"D",shape:"",x:e,y:t};const s=BABYLON.MeshBuilder.CreateBox("head",{height:.2,width:.4,depth:.4},this.scene);return s.setParent(n),s.position=new k(0,.1,0),s.material=B(this.colors.D,this.scene),n}placeFlower(e){if(e.metadata.picked)return e.setParent(this.inventoryTransform),O.Instance.animateTransform({mesh:e,end:{position:k.Zero(),rotation:k.Zero(),scaling:new k(.25,.25,.25)},duration:200}),e.renderingGroupId=1,e.isPickable=!1,void e.setEnabled("D"!==e.metadata.color);const{x:t,y:n}=e.metadata;e.setParent(this.parent),O.Instance.animateTransform({mesh:e,end:{position:this.boardPos(t,n),rotation:k.Zero(),scaling:k.One()},duration:200}),e.isPickable=!0,e.setEnabled(!0),e.renderingGroupId=0}reset(){this.meshes.forEach((e=>{e.dispose()})),this.selectedMesh=null;const n=BABYLON.MeshBuilder.CreateGround("flower-puzzle-ground",{width:this.boardWidth,height:this.boardHeight});n.material=((e,t,n,s,o)=>{const[i,r]=c(512);r.imageSmoothingEnabled=!1;const a=512/n,l=512/s;r.fillStyle=e,r.fillRect(0,0,i.width,i.height),r.fillStyle=t;for(let e=0;e<s;e++)for(let t=0;t<n;t++)(t+e)%2||r.fillRect(t*a,e*l,a,l);const u=new h("material"+ ++p,o),B=d.LoadFromDataString("texture"+ ++p,i.toDataURL(),o);return u.diffuseTexture=B,u})(e,t,this.boardWidth,this.boardHeight,this.scene),n.setParent(this.parent),n.position=new k(.5*this.boardWidth,.02,-.5*this.boardHeight);for(let e=-1;e<this.boardHeight+1;e++)for(let t=-1;t<this.boardWidth+1;t++){if(e>=0&&e<this.boardHeight&&t>=0&&t<this.boardWidth)continue;const n=this.createBush();n.setParent(this.parent),n.name=`bush${t},${e}`,n.position=this.boardPos(t,e)}this.board.forEach(((e,t)=>{e.forEach(((e,n)=>{let s;const[o,i,r]=e.split("");switch(i){case"":return;case"R":case"Y":case"B":case"W":s=this.createFlower(parseInt(o),i,r,n,t),s.name=`cell${n}-${t}`,this.placeFlower(s)}}))})),this.selectedMesh=this.createEmpty(-1,-1),this.selectedMesh.metadata={...this.selectedMesh.metadata,picked:!0},this.placeFlower(this.selectedMesh),this.solved=!1}}const{TransformNode:z,Vector3:V,MeshBuilder:D}=BABYLON;class W{constructor(e){this.solved=!1,this.solvedCount=0,this.scene=e,this.puzzles=[],this.floors=[],this.parent=new z("Garden",this.scene),this.endgameSphere=null,this.reset()}get model(){return this.parent}set position(e){this.parent.position=e}set scale(e){this.parent.scaling=e}isSolved(){if(this.solved)return!0;this.solvedCount=0;for(let e=0;e<this.puzzles.length;e++)this.puzzles[e].solved&&(this.solvedCount+=1);if(this.solved=this.puzzles.length>0&&this.solvedCount===this.puzzles.length,this.solved){if(!this.endgameSphere)return;this.endgameSphere.setEnabled(!0),this.endgameSphere.scaling=V.Zero(),O.Instance.animateTransform({mesh:this.endgameSphere,end:{scaling:new V(1,1,1)},ease:new BABYLON.ExponentialEase(2),duration:1e3})}return this.solved}reset(){this.floors=[];const e=D.CreateTiledGround("Garden-ground",{xmin:-18,xmax:18,zmin:-6,zmax:10,subdivisions:{h:12,w:24}},this.scene);e.material=(e=>{const[t,n]=c(256);n.fillStyle="#6d4d41",n.fillRect(0,0,t.width,t.height),n.fillStyle="#49332b";for(let e=0;e<12;e++){const e=Math.random()*(t.width-12),s=Math.random()*(t.height-12);n.fillRect(e,s,12,12)}return m(t,e)})(this.scene),e.setParent(this.parent),e.position=new V(0,.01,0),this.floors.push(e),D.CreateTorus("fountain-edge",{diameter:4,thickness:1,tessellation:32},this.scene).setParent(this.parent);const t=D.CreateCylinder("fountain-water",{diameter:4,height:1,tessellation:32});t.material=function(e){const t=e.baseColor||new BABYLON.Color4(.1450980392156863,.23921568627450981,.6470588235294118,1),n=e.rippleColor||new BABYLON.Color4(.0392156862745098,.8352941176470589,.8784313725490196,1),s=e.frozen||!1,o=new BABYLON.NodeMaterial("node"),i=new BABYLON.InputBlock("position");i.visibleInInspector=!1,i.visibleOnFrame=!1,i.target=1,i.setAsAttribute("position");const r=new BABYLON.TransformBlock("WorldPos");r.visibleInInspector=!1,r.visibleOnFrame=!1,r.target=1,r.complementZ=0,r.complementW=1;const a=new BABYLON.InputBlock("World");a.visibleInInspector=!1,a.visibleOnFrame=!1,a.target=1,a.setAsSystemValue(BABYLON.NodeMaterialSystemValues.World);const l=new BABYLON.TransformBlock("WorldPos * ViewProjectionTransform");l.visibleInInspector=!1,l.visibleOnFrame=!1,l.target=1,l.complementZ=0,l.complementW=1;const c=new BABYLON.InputBlock("ViewProjection");c.visibleInInspector=!1,c.visibleOnFrame=!1,c.target=1,c.setAsSystemValue(BABYLON.NodeMaterialSystemValues.ViewProjection);const h=new BABYLON.VertexOutputBlock("VertexOutput");h.visibleInInspector=!1,h.visibleOnFrame=!1,h.target=1;const d=new BABYLON.InputBlock("TwirlCenter");d.visibleInInspector=!1,d.visibleOnFrame=!1,d.target=1,d.value=new BABYLON.Vector2(.5,.5),d.isConstant=!1;const p=new BABYLON.VectorSplitterBlock("VectorSplitter");p.visibleInInspector=!1,p.visibleOnFrame=!1,p.target=4;const u=new BABYLON.AddBlock("Add");u.visibleInInspector=!1,u.visibleOnFrame=!1,u.target=1;const B=new BABYLON.VectorMergerBlock("VectorMerger");B.visibleInInspector=!1,B.visibleOnFrame=!1,B.target=1,B.xSwizzle="x",B.ySwizzle="y",B.zSwizzle="z",B.wSwizzle="w";const m=new BABYLON.SubtractBlock("Subtract (x)");m.visibleInInspector=!1,m.visibleOnFrame=!1,m.target=1;const g=new BABYLON.MultiplyBlock("Multiply");g.visibleInInspector=!1,g.visibleOnFrame=!1,g.target=1;const w=new BABYLON.TrigonometryBlock("Cos");w.visibleInInspector=!1,w.visibleOnFrame=!1,w.target=4,w.operation=BABYLON.TrigonometryBlockOperations.Cos;const b=new BABYLON.MultiplyBlock("Strength x Delta Lergth");b.visibleInInspector=!1,b.visibleOnFrame=!1,b.target=1;const v=new BABYLON.InputBlock("TwirlStrength");v.visibleInInspector=!1,v.visibleOnFrame=!1,v.target=1,v.value=2,v.min=0,v.max=0,v.isBoolean=!1,v.matrixMode=0,v.animationType=BABYLON.AnimatedInputBlockTypes.None,v.isConstant=!1;const f=new BABYLON.LengthBlock("Delta (Length)");f.visibleInInspector=!1,f.visibleOnFrame=!1,f.target=1;const O=new BABYLON.SubtractBlock("Delta (Subtract)");O.visibleInInspector=!1,O.visibleOnFrame=!1,O.target=1;const T=new BABYLON.InputBlock("uv");T.visibleInInspector=!1,T.visibleOnFrame=!1,T.target=1,T.setAsAttribute("uv");const I=new BABYLON.VectorSplitterBlock("VectorSplitter");I.visibleInInspector=!1,I.visibleOnFrame=!1,I.target=1;const A=new BABYLON.MultiplyBlock("Multiply");A.visibleInInspector=!1,A.visibleOnFrame=!1,A.target=1;const L=new BABYLON.TrigonometryBlock("Sin");L.visibleInInspector=!1,L.visibleOnFrame=!1,L.target=1,L.operation=BABYLON.TrigonometryBlockOperations.Sin;const N=new BABYLON.AddBlock("Add (y)");N.visibleInInspector=!1,N.visibleOnFrame=!1,N.target=1;const M=new BABYLON.MultiplyBlock("Multiply");M.visibleInInspector=!1,M.visibleOnFrame=!1,M.target=1;const y=new BABYLON.TrigonometryBlock("Cos");y.visibleInInspector=!1,y.visibleOnFrame=!1,y.target=1,y.operation=BABYLON.TrigonometryBlockOperations.Cos;const S=new BABYLON.MultiplyBlock("Multiply");S.visibleInInspector=!1,S.visibleOnFrame=!1,S.target=1;const Y=new BABYLON.TrigonometryBlock("Sin");Y.visibleInInspector=!1,Y.visibleOnFrame=!1,Y.target=4,Y.operation=BABYLON.TrigonometryBlockOperations.Sin;const x=new BABYLON.VoronoiNoiseBlock("VoronoiNoise");x.visibleInInspector=!1,x.visibleOnFrame=!1,x.target=4;const k=new BABYLON.AddBlock("Add");k.visibleInInspector=!1,k.visibleOnFrame=!1,k.target=4;const C=new BABYLON.InputBlock("Time");C.visibleInInspector=!1,C.visibleOnFrame=!1,C.target=1,C.value=0,C.min=0,C.max=0,C.isBoolean=!1,C.matrixMode=0,C.animationType=s?BABYLON.AnimatedInputBlockTypes.None:BABYLON.AnimatedInputBlockTypes.Time,C.isConstant=s;const P=new BABYLON.InputBlock("Offset");P.visibleInInspector=!1,P.visibleOnFrame=!1,P.target=1,P.value=666,P.min=0,P.max=0,P.isBoolean=!1,P.matrixMode=0,P.animationType=BABYLON.AnimatedInputBlockTypes.None,P.isConstant=!0;const E=new BABYLON.InputBlock("Scale");E.visibleInInspector=!1,E.visibleOnFrame=!1,E.target=1,E.value=12,E.min=0,E.max=0,E.isBoolean=!1,E.matrixMode=0,E.animationType=BABYLON.AnimatedInputBlockTypes.None,E.isConstant=!1;const F=new BABYLON.ColorMergerBlock("ColorMerger");F.visibleInInspector=!1,F.visibleOnFrame=!1,F.target=4,F.rSwizzle="r",F.gSwizzle="g",F.bSwizzle="b",F.aSwizzle="a";const R=new BABYLON.InputBlock("ColorAlpha");R.visibleInInspector=!1,R.visibleOnFrame=!1,R.target=1,R.value=1,R.min=0,R.max=0,R.isBoolean=!1,R.matrixMode=0,R.animationType=BABYLON.AnimatedInputBlockTypes.None,R.isConstant=!0;const z=new BABYLON.MultiplyBlock("Multiply");z.visibleInInspector=!1,z.visibleOnFrame=!1,z.target=4;const V=new BABYLON.InputBlock("RippleColor");V.visibleInInspector=!1,V.visibleOnFrame=!1,V.target=1,V.value=n,V.isConstant=!1;const D=new BABYLON.MaxBlock("Max");D.visibleInInspector=!1,D.visibleOnFrame=!1,D.target=4;const W=new BABYLON.InputBlock("BaseColor");W.visibleInInspector=!1,W.visibleOnFrame=!1,W.target=1,W.value=t,W.isConstant=!1;const $=new BABYLON.FragmentOutputBlock("FragmentOutput");$.visibleInInspector=!1,$.visibleOnFrame=!1,$.target=2,$.convertToGammaSpace=!1,$.convertToLinearSpace=!1,$.useLogarithmicDepth=!1;const G=new BABYLON.InputBlock("Opacity");return G.visibleInInspector=!1,G.visibleOnFrame=!1,G.target=1,G.value=1,G.min=0,G.max=0,G.isBoolean=!1,G.matrixMode=0,G.animationType=BABYLON.AnimatedInputBlockTypes.None,G.isConstant=!1,i.output.connectTo(r.vector),a.output.connectTo(r.transform),r.output.connectTo(l.vector),c.output.connectTo(l.transform),l.output.connectTo(h.vector),d.output.connectTo(p.xyIn),p.xyOut.connectTo(u.left),v.output.connectTo(b.left),T.output.connectTo(O.left),p.xyOut.connectTo(O.right),O.output.connectTo(f.value),f.output.connectTo(b.right),b.output.connectTo(w.input),w.output.connectTo(g.left),O.output.connectTo(I.xyIn),I.x.connectTo(g.right),g.output.connectTo(m.left),b.output.connectTo(Y.input),Y.output.connectTo(S.left),I.y.connectTo(S.right),S.output.connectTo(m.right),m.output.connectTo(B.x),I.x.connectTo(A.left),b.output.connectTo(L.input),L.output.connectTo(A.right),A.output.connectTo(N.left),b.output.connectTo(y.input),y.output.connectTo(M.left),I.y.connectTo(M.right),M.output.connectTo(N.right),N.output.connectTo(B.y),B.xy.connectTo(u.right),u.output.connectTo(x.seed),C.output.connectTo(k.left),P.output.connectTo(k.right),k.output.connectTo(x.offset),E.output.connectTo(x.density),x.output.connectTo(F.r),x.output.connectTo(F.g),x.output.connectTo(F.b),R.output.connectTo(F.a),F.rgba.connectTo(z.left),V.output.connectTo(z.right),z.output.connectTo(D.left),W.output.connectTo(D.right),D.output.connectTo($.rgba),G.output.connectTo($.a),o.addOutputNode(h),o.addOutputNode($),o.build(),o}({}),t.checkCollisions=!0,t.setParent(this.parent);const n=D.CreateTorusKnot("fountain-statue",{tube:.1,radialSegments:128,p:5,q:2},this.scene);n.setParent(this.parent);const s=new V(0,1.5,0);n.position=s,n.rotation.x=Math.PI/2,n.scaling=new V(.5,.5,1.5),n.registerBeforeRender((e=>{this.solvedCount>0&&e.rotateAround(s,V.Up(),Math.PI/1700*this.scene.getEngine().getDeltaTime()),this.solvedCount>1&&e.rotateAround(s,V.Right(),Math.PI/800*this.scene.getEngine().getDeltaTime()),this.solvedCount>2&&e.rotateAround(s,V.Forward(),Math.PI/500*this.scene.getEngine().getDeltaTime())})),this.endgameSphere=D.CreateSphere("endgame-sphere",{diameter:1,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene),this.endgameSphere.material=B(r,this.scene),this.endgameSphere.renderingGroupId=1,this.endgameSphere.setParent(this.parent),this.endgameSphere.position.y=1.5,this.endgameSphere.onPointerPick=()=>{O.Instance.animateTransform({mesh:this.endgameSphere,end:{scaling:new V(100,100,100)},ease:new BABYLON.ExponentialEase(2),duration:1e4})},this.endgameSphere.setEnabled(!1);const o=[[["1RT","1RT"],["2BT","2BT"]],[["0ET","2RC","0ET","0ET","1BS"],["2RC","0ET","1BS","0ET","0ET"],["0ET","2RC","0ET","1BS","0ET"],["2RC","0ET","1BS","0ET","1BS"],["0ET","1BS","0ET","0ET","0ET"]],[["3YT"],["1YT"],["1YT"],["2YT"],["2YT"]],[["0ET","0ET","3BS","0ET","0ET"],["0ET","2RS","3BC","3BS","0ET"],["2RS","2BS","1RC","3BC","1BS"],["0ET","1RS","3BS","1BC","0ET"],["0ET","0ET","2BS","0ET","0ET"]]],i=[new V(-15,0,6),new V(-9,0,2),new V(4,0,2),new V(9,0,5)];for(let e=0;e<o.length;e++){const t=i[e],n=new R({board:o[e],solvedEvent:()=>{this.isSolved()}},this.scene);n.model.setParent(this.parent),n.position=t,n.isSolved(),this.puzzles.push(n)}this.solved=!1}}const{TransformNode:$,MeshBuilder:G,Vector3:Z}=BABYLON;let U=0;const{TransformNode:H,Vector3:_}=BABYLON;class j{constructor(e,t){this.solved=!1,this.updateDials=()=>{this.dials.forEach((e=>{const t=parseInt(e.metadata.alphabetIndex,10),n=2*Math.PI/this.alphabet.length,s=.5*Math.PI+.5*n+t*n;O.Instance.animateTransform({mesh:e,end:{rotation:new _(0,s,0)},duration:60})}))},this.scene=t,this.alphabet=e.alphabet?.split("")||Array.from("0123456789"),this.code=e.code?.split("")||Array.from("123"),this.guess=Array.from(this.alphabet[0].repeat(this.code.length)),this.parent=new H("DialPuzzle",this.scene),this.parent.position=_.Zero(),this.dials=[],this.solvedEvent=e.solvedEvent?e.solvedEvent:()=>{},this.reset()}get model(){return this.parent}set scale(e){this.parent.scaling=e}isSolved(){return!!this.solved||(this.solved=this.code.every(((e,t)=>this.guess[t]===e)),this.solved&&(A(),this.solvedEvent()),this.solved)}reset(){this.solved=!1,this.dials=[];const e=this.code.length,t=1*Math.sin(Math.PI/this.alphabet.length);for(let n=0;n<e;n++){const s=[];s[0]=new BABYLON.Vector4(0,0,0,0),s[1]=new BABYLON.Vector4(1,0,0,1),s[2]=new BABYLON.Vector4(0,0,0,0);const o=BABYLON.MeshBuilder.CreateCylinder(`dial-${n}`,{height:t,diameter:1,faceUV:s,tessellation:this.alphabet.length},this.scene);o.onPointerPick=()=>{if(T(...[,,76,.02,.02,.01,1,.44,,,,,,.5,,,,,.01,.57]),this.solved)return;const{index:e,alphabetIndex:t}=o.metadata,s=t+1;o.metadata={index:n,alphabetIndex:s},this.guess[e]=this.alphabet[s%this.alphabet.length],this.updateDials(),this.isSolved()},o.setParent(this.parent),o.position=new _(0,(e-n-1)*(t+.05)+.15,0),o.material=g(this.alphabet,this.scene),o.metadata={index:n,alphabetIndex:0},this.dials.push(o)}const s=BABYLON.MeshBuilder.CreateBox("dial-align",{height:(t+.05)*(e+1),width:.2,depth:.2});s.setParent(this.parent),s.position=new _(0,.15*e,-.26),s.material=B(n,this.scene),this.updateDials()}}const{TransformNode:X,MeshBuilder:q,Vector3:K}=BABYLON;let J=0;const{TransformNode:Q,MeshBuilder:ee,Vector3:te}=BABYLON;let ne=0;const se=e=>{const t=new Q("Banner"+ ++ne,e),o=ee.CreateGround("symbols",{width:4,height:4,subdivisions:12,updatable:!0},e);o.setParent(t),o.position=new te(0,2,0),o.rotation.x=3*Math.PI/2,o.material=(e=>{const[t,o]=c(512);return o.fillStyle=n,o.fillRect(128,0,256,512),o.fillStyle=s,o.fillRect(192,64,128,128),o.beginPath(),o.moveTo(256,256),o.arc(256,256,64,0,2*Math.PI),o.fill(),o.beginPath(),o.moveTo(256,320),o.lineTo(320,431),o.lineTo(192,431),o.fill(),m(t,e)})(e);let i=0;return o.registerBeforeRender((t=>{i+=e.getEngine().getDeltaTime();const n=t.getVerticesData(BABYLON.VertexBuffer.PositionKind);if(n){for(let e=0;e<n?.length;e+=3)n[e+1]=.1*(n[e+2]-2)*Math.sin(.8*i/100+n[e+2]);t.updateVerticesData(BABYLON.VertexBuffer.PositionKind,n)}})),t},{TransformNode:oe,MeshBuilder:ie,Vector3:re}=BABYLON;let ae=0;const{MeshBuilder:le,TransformNode:ce,Vector3:he}=BABYLON;class de{constructor(e){this.solved=!1,this.scene=e,this.puzzles=[],this.floors=[],this.bushes=[],this.parent=new ce("Entrance",this.scene),this.reset()}get model(){return this.parent}set position(e){this.parent.position=e}set scale(e){this.parent.scaling=e}isSolved(){return!!this.solved||(this.solved=this.puzzles.length>0&&this.puzzles.every((e=>e.solved)),this.bushes.forEach(((e,t)=>{e.position.z<-14||e.position.z>-12||O.Instance.animateTransform({mesh:e,end:{position:e.position.add(new he(0,3,0))},duration:5e3,delay:100})})),this.solved)}reset(){this.floors=[];const e=le.CreateTiledGround("ground",{xmin:-10,xmax:12,zmin:-20,zmax:12,subdivisions:{w:11,h:16}});e.setParent(this.parent),e.material=(e=>{const[t,n]=c(512);n.fillStyle="#c5a296",n.fillRect(0,0,t.width,t.height),n.save(),n.strokeStyle=r,n.lineWidth=4;return n.fillStyle="#30312D",n.fillRect(0,0,t.width,t.height),["#4A4B46","#484848","#4E523F","#63645F","#64655f"].forEach((e=>{n.fillStyle=e;for(let e=0;e<128;e++){const e=Math.random()*(t.width-16)+8,s=Math.random()*(t.height-16)+8;n.beginPath(),n.moveTo(e,s),n.arc(e,s,8,0,2*Math.PI),n.fill()}})),m(t,e)})(this.scene),e.position.y=-.01,e.position=new he(0,.01,0);const t=[{shape:"box",count:3},{shape:"sphere",count:5},{shape:"triangle",count:4}];t.forEach(((e,t)=>{const n=((e,t)=>{const n=new $("Tree"+ ++U,t),s=e.count||3,o=e.shape||"box",i=G.CreateCylinder("trunk"+ ++U,{diameter:.5,height:3,tessellation:6});i.material=Y({color1:"#332211",color2:"#593b1d",scale:5}),i.setParent(n),i.position=new Z(0,1.5,0);for(let e=0;e<s;e++){let n;switch(o){case"box":n=G.CreateBox("shape"+ ++U,{size:1.5},t);break;case"triangle":n=G.CreateCylinder("shape"+ ++U,{diameterTop:0,diameterBottom:4,tessellation:3},t);break;case"sphere":n=G.CreateSphere("shape"+ ++U,{diameter:2},t)}if(!n)return;n.material=Y({color1:"#00ff00",color2:"#332211",scale:25}),n.setParent(i),n.position.y=.75*e+.5,n.position.x=.25*(s-e),n.rotation=new Z(2*Math.random()*Math.PI,2*Math.random()*Math.PI,2*Math.random()*Math.PI),n.rotateAround(Z.Zero(),Z.Up(),2*Math.random()*Math.PI)}return n})(e,this.scene);n&&(n.setParent(this.parent),n.position=new he(0,0,-4*t+4))}));const n=new j({code:t.map((e=>e.count)).join(""),alphabet:"012345",solvedEvent:()=>{this.isSolved()}},this.scene);n.model.setParent(this.parent),n.model.position=new he(11.5,.5,7.5),n.model.rotation=new he(0,Math.PI/4,0),this.puzzles.push(n);const s=(e=>{const t=new X("Door"+ ++J,e),n=[new K(2,0,0),new K(2,2,0),new K(1.74,3,0),new K(1,3.74,0),new K(0,4,0),new K(-1,3.74,0),new K(-1.74,3,0),new K(-2,2,0),new K(-2,0,0)],s=[new K(0,0,.5),new K(0,0,-.5)],o=[new K(.51,-.1,0),new K(.51,0,0),new K(-.51,0,0),new K(-.51,-.1,0)],i=[new K(0,0,0),new K(0,4,0)],r=[new K(.1,0,0),new K(.2,0,0),new K(.2,.05,0),new K(.1,.05,0)],a=q.ExtrudeShape("door",{shape:n,path:s,closeShape:!0,cap:BABYLON.Mesh.CAP_ALL},e);a.material=Y({color1:"#332211",color2:"#593b1d",scale:5}),a.setParent(t);const l=q.ExtrudeShape("frame",{shape:o,path:n,closeShape:!0,cap:BABYLON.Mesh.CAP_ALL},e);l.material=B("#888888",e),l.setParent(t);const c=q.ExtrudeShape("frame",{shape:o,path:i,closeShape:!0,cap:BABYLON.Mesh.CAP_ALL},e);c.material=B("#000000",e),c.setParent(t);const h=BABYLON.MeshBuilder.CreateLathe("handle",{shape:r,radius:1,closed:!0,tessellation:12,sideOrientation:BABYLON.Mesh.DOUBLESIDE},e);return h.material=B("#000000",e),h.setParent(t),h.rotation.x=Math.PI/2,h.position=new K(-.5,1,-.55),h.clone("handle2").position.x*=-1,t})(this.scene);s.setParent(this.parent),s.position=new he(9.5,0,9.5),s.rotation=new he(0,Math.PI/4,0);const o=se(this.scene);o.setParent(this.parent),o.position=new he(-5,8,11.5);const i=se(this.scene);i.setParent(this.parent),i.position=new he(11.6,8,0),i.rotation=new he(0,Math.PI/2,0),this.floors.push(e);const l=(e=>{const t=new oe("Door"+ ++ae,e),n=ie.CreateBox("Bush"+ ++ae,{width:.95,depth:.95,height:3},e);return n.setParent(t),n.position=new re(0,1.5,0),n.material=Y({color1:"#00ff00",color2:"#ff00ff",scale:60}),n.checkCollisions=!0,t})(this.scene);for(let e=0;e<16;e++){const t=l.clone(`Bush${e}`,this.parent,!1);t&&(t.position=new he(12.5,0,-19.5+e),this.bushes.push(t),a&&t.setEnabled(!1))}l.dispose(),this.solved=!1}}const{Engine:pe,Scene:ue,MeshBuilder:Be,HemisphericLight:me,UniversalCamera:ge,Vector3:we,PointerEventTypes:be}=BABYLON,ve=async()=>{let e=!1;document.getElementById("intro").style.display="none";const t=document.getElementById("c");t.style.display="block",t.addEventListener("click",(async()=>{document.pointerLockElement!==t&&await t.requestPointerLock({unadjustedMovement:!0})}));const n=new pe(t,!0),s=new ue(n);O.Instance.initScene(s),s.gravity=new we(0,-.15,0),s.collisionsEnabled=!0,a&&s.debugLayer.show({embedMode:!0}),n.displayLoadingUI();const i=new ge("MainCamera",new we(-23,1.615,13.5),s);i.inertia=0,i.speed=3,i.keysUp.push(87),i.keysDown.push(83),i.keysLeft.push(65),i.keysRight.push(68),i.keysUpward.push(69),i.keysDownward.push(81),i.attachControl(t,!0),i.angularSensibility=500,i.applyGravity=!0,i.ellipsoid=new we(.4,.8,.4),i.checkCollisions=!0,i.minZ=.1,s.onPointerObservable.add((t=>{if(t.type!==be.POINTERDOWN)return;if(!s)return;if(!e&&0!==t.event.button)return;const o=e?t.pickInfo:s.pick(n.getRenderWidth()/2,n.getRenderHeight()/2);let i=o?.pickedMesh;for(;i&&!i.onPointerPick;)i=i.parent;i&&i.onPointerPick&&i.onPointerPick()})),n.runRenderLoop((()=>{s.render()})),window.addEventListener("resize",(()=>{n.resize()}));const h=new BABYLON.TransformNode("inventory-parent",s);h.setParent(s.activeCamera),h.position=new we(-.5,0,2);const d=BABYLON.MeshBuilder.CreatePlane("cursor",{},s);d.isPickable=!1,d.material=(e=>{const[t,n]=c(512);n.imageSmoothingEnabled=!1,n.lineCap="round",n.beginPath(),n.moveTo(250,256),n.lineTo(262,256),n.moveTo(256,250),n.lineTo(256,262),n.lineWidth=2,n.strokeStyle=r,n.stroke(),n.lineWidth=1.5,n.strokeStyle=o,n.stroke();const s=m(t,e);return s.disableLighting=!0,s.emissiveColor=BABYLON.Color3.White(),s.diffuseTexture.hasAlpha=!0,s})(s),d.setParent(i),d.position=new we(0,0,1.1),d.renderingGroupId=1,new me("light",new we(-.5,1,0),s);const p=Be.CreateTiledGround("ground",{xmin:-50,xmax:100,zmin:-20,zmax:80,subdivisions:{w:20,h:10}});p.material=(e=>{const[t,n]=c(512),[s,o]=c(2*t.width),i=t.width/32;o.save();const r=["#abb348","#7ca244","#426d38","#799c45","#a7af48"],a=[];for(let e=0;e<32;e++)for(let t=0;t<32;t++)a.push({x:t,y:e});const h=(e=>{for(let t=e.length-1;t>1;t--){const n=Math.floor(Math.random()*t),s=e[t];e[t]=e[n],e[n]=s}return e})(a);return o.translate(.25*s.width,.25*s.height),h.forEach((e=>{const{x:t,y:n}=e;o.save(),o.fillStyle=l(r),o.translate(t*i,n*i);const a=1*Math.random()+1,c=Math.random()*Math.PI;o.save(),o.scale(a,a),o.rotate(c),o.fillRect(-.5*i,-.5*i,i,i),o.restore(),0==t&&(o.save(),o.translate(.5*s.width,0),o.save(),o.scale(a,a),o.rotate(c),o.fillRect(-.5*i,-.5*i,i,i),o.restore(),o.restore()),0==n&&(o.save(),o.translate(0,.5*s.height),o.save(),o.scale(a,a),o.rotate(c),o.fillRect(-.5*i,-.5*i,i,i),o.restore(),o.restore()),o.restore()})),o.restore(),n.drawImage(s,.25*s.width,.25*s.height,.5*s.width,.5*s.height,0,0,t.width,t.height),m(t,e)})(s),p.checkCollisions=!0,p.position.y=-.01;const u=new de(s);u.position=new we(-15,0,32);const B=new f(s);B.position=new we(3,0,40),B.scale=new we(2,2,2),i.setTarget(new we(-1,10,43));const g=new W(s);g.position=new we(15,0,18);const w=Be.CreateBox("bounds",{width:58,height:5,depth:32,sideOrientation:BABYLON.Mesh.BACKSIDE},s);w.position=new we(4,0,28),w.checkCollisions=!0,w.visibility=0,n.hideLoadingUI();const b=await s.createDefaultXRExperienceAsync({floorMeshes:[...u.floors,...g.floors]});b.input.onControllerAddedObservable.add((e=>{e.onMotionControllerInitObservable.add((e=>{e.onModelLoadedObservable.add((e=>{h.setParent(e.rootMesh),h.position=new we(0,.1,.1),h.rotation=we.Zero()}))}))})),b.input.onControllerRemovedObservable.add(((e,t)=>{h.setParent(s.activeCamera),h.position=new we(-.5,0,2),h.rotation=we.Zero()})),b.baseExperience.onStateChangedObservable.add((t=>{e=t===BABYLON.WebXRState.IN_XR,d.isEnabled(!e),a&&console.log("inXRMode",e,b.input.controllers),e||(h.setParent(s.activeCamera),h.position=new we(-.5,0,2),h.rotation=we.Zero())}))};window.addEventListener("DOMContentLoaded",(()=>{document.getElementById("playButton").onclick=ve}))})();