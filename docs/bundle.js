(()=>{"use strict";const e="#12b212",t="#0a650a",n="#ffc20a",o="#ffffff",s="#666666",i="#000000",r="#0065BF",a=window.location.search.includes("debug"),l=e=>e[Math.floor(Math.random()*e.length)],c=(e=512)=>{const t=document.createElement("canvas");t.width=e,t.height=e;const n=t.getContext("2d");return[t,n]},{StandardMaterial:h,Texture:d}=BABYLON;let p=0;const u=(e=!0,t,n)=>{const[r,a]=c(512);a.fillStyle="#c5a296",a.fillRect(0,0,r.width,r.height);const h=16/t,d=32/t;a.save(),a.strokeStyle=i,a.lineWidth=4;const p=["#dd7d7d","#cb6b6b","#b65454","#9e3333","#842020"];for(let e=0;e*h<r.height;e++)for(let t=0;t*d<r.width;t++){a.fillStyle=l(p);const n=e%2?0:-.5*d;a.fillRect(t*d+n,e*h,d-1,h-1),0===t&&a.fillRect(t*d+r.width+n,e*h,d-1,h-1)}return a.restore(),e&&(a.fillStyle=s,a.fillRect(192,128,128,256),a.strokeStyle=o,a.lineWidth=16,a.strokeRect(192,128,128,256),a.beginPath(),a.moveTo(256,128),a.lineTo(256,384),a.moveTo(192,224),a.lineTo(320,224),a.stroke()),m(r,n)},B=(e,t)=>{const n=new h("billboardMaterial"+ ++p,t);return n.diffuseColor=BABYLON.Color3.FromHexString(e),n},m=(e,t)=>{const n=new h("material"+ ++p,t),o=d.LoadFromDataString("texture"+ ++p,e.toDataURL(),t);return o.hasAlpha=!0,n.diffuseTexture=o,n},g=e=>{const[t,n]=c(512);n.fillStyle="#c5a296",n.fillRect(0,0,t.width,t.height),n.save(),n.strokeStyle=i,n.lineWidth=4;return n.fillStyle="#30312D",n.fillRect(0,0,t.width,t.height),["#4A4B46","#484848","#4E523F","#63645F","#64655f"].forEach((e=>{n.fillStyle=e;for(let e=0;e<128;e++){const e=Math.random()*(t.width-16)+8,o=Math.random()*(t.height-16)+8;n.beginPath(),n.moveTo(e,o),n.arc(e,o,8,0,2*Math.PI),n.fill()}})),m(t,e)},w=(e,t)=>{const[o,r]=c(512);r.fillStyle=n,r.fillRect(0,0,o.width,o.height),r.fillStyle=i;const a=o.width/e.length;return r.font=`${a}px Helvetica`,r.scale(1,o.height/a),r.textBaseline="middle",r.textAlign="center",e.forEach(((e,t)=>{r.strokeStyle=s,r.strokeRect(t*a,0,(t+1)*a,a),r.fillText(`${e}`,t*a+.5*a,.5*a)})),m(o,t)},b={},v=e=>{const[t,o]=c(512);return o.fillStyle=r,o.fillRect(128,0,256,512),o.fillStyle=n,o.fillRect(192,64,128,128),o.beginPath(),o.moveTo(256,256),o.arc(256,256,64,0,2*Math.PI),o.fill(),o.beginPath(),o.moveTo(256,320),o.lineTo(320,431),o.lineTo(192,431),o.fill(),m(t,e)},f=function(e){const t=BABYLON.Color3.FromHexString(e.color1||"#ff0000"),n=BABYLON.Color3.FromHexString(e.color2||"#0000ff"),o=e.scale||1,s=new BABYLON.NodeMaterial("node");s.mode=BABYLON.NodeMaterialModes.Material;const i=new BABYLON.InputBlock("position");i.visibleInInspector=!1,i.visibleOnFrame=!1,i.target=1,i.setAsAttribute("position");const r=new BABYLON.TransformBlock("WorldPos");r.visibleInInspector=!1,r.visibleOnFrame=!1,r.target=1,r.complementZ=0,r.complementW=1;const a=new BABYLON.InputBlock("World");a.visibleInInspector=!1,a.visibleOnFrame=!1,a.target=1,a.setAsSystemValue(BABYLON.NodeMaterialSystemValues.World);const l=new BABYLON.TransformBlock("World normal");l.visibleInInspector=!1,l.visibleOnFrame=!1,l.target=1,l.complementZ=0,l.complementW=0;const c=new BABYLON.InputBlock("normal");c.visibleInInspector=!1,c.visibleOnFrame=!1,c.target=1,c.setAsAttribute("normal");const h=new BABYLON.LightBlock("Lights");h.visibleInInspector=!1,h.visibleOnFrame=!1,h.target=3;const d=new BABYLON.InputBlock("cameraPosition");d.visibleInInspector=!1,d.visibleOnFrame=!1,d.target=1,d.setAsSystemValue(BABYLON.NodeMaterialSystemValues.CameraPosition);const p=new BABYLON.MultiplyBlock("Multiply");p.visibleInInspector=!1,p.visibleOnFrame=!1,p.target=4;const u=new BABYLON.GradientBlock("Gradient");u.visibleInInspector=!1,u.visibleOnFrame=!1,u.target=4,u.colorSteps=[],u.colorSteps.push(new BABYLON.GradientBlockColorStep(0,t)),u.colorSteps.push(new BABYLON.GradientBlockColorStep(1,n));const B=new BABYLON.SimplexPerlin3DBlock("SimplexPerlin3D");B.visibleInInspector=!1,B.visibleOnFrame=!1,B.target=4;const m=new BABYLON.ScaleBlock("Scale");m.visibleInInspector=!1,m.visibleOnFrame=!1,m.target=4;const g=new BABYLON.InputBlock("Scale");g.visibleInInspector=!1,g.visibleOnFrame=!1,g.target=1,g.value=o,g.min=0,g.max=0,g.isBoolean=!1,g.matrixMode=0,g.animationType=BABYLON.AnimatedInputBlockTypes.None,g.isConstant=!0;const w=new BABYLON.FragmentOutputBlock("FragmentOutput");w.visibleInInspector=!1,w.visibleOnFrame=!1,w.target=2,w.convertToGammaSpace=!1,w.convertToLinearSpace=!1,w.useLogarithmicDepth=!1;const b=new BABYLON.TransformBlock("WorldPos * ViewProjectionTransform");b.visibleInInspector=!1,b.visibleOnFrame=!1,b.target=1,b.complementZ=0,b.complementW=1;const v=new BABYLON.InputBlock("ViewProjection");v.visibleInInspector=!1,v.visibleOnFrame=!1,v.target=1,v.setAsSystemValue(BABYLON.NodeMaterialSystemValues.ViewProjection);const f=new BABYLON.VertexOutputBlock("VertexOutput");return f.visibleInInspector=!1,f.visibleOnFrame=!1,f.target=1,i.output.connectTo(r.vector),a.output.connectTo(r.transform),r.output.connectTo(b.vector),v.output.connectTo(b.transform),b.output.connectTo(f.vector),r.output.connectTo(h.worldPosition),c.output.connectTo(l.vector),a.output.connectTo(l.transform),l.output.connectTo(h.worldNormal),d.output.connectTo(h.cameraPosition),h.diffuseOutput.connectTo(p.left),r.xyz.connectTo(m.input),g.output.connectTo(m.factor),m.output.connectTo(B.seed),B.output.connectTo(u.gradient),u.output.connectTo(p.right),p.output.connectTo(w.rgb),s.addOutputNode(f),s.addOutputNode(w),s.build(),s},{TransformNode:O,Vector3:A}=BABYLON;class I{constructor(e){this.solved=!1,this.scene=e,this.parent=new O("Castle",this.scene),this.reset()}get model(){return this.parent}set position(e){this.parent.position=e}set scale(e){this.parent.scaling=e}isSolved(){return this.solved}reset(){[[-11.5,3,5,5,6,6],[-5.5,5,4,7,10,4],[0,5,3,4,10,6],[1.5,3,-3,9,6,6],[10.5,2.5,-4,9,5,4],[13.5,1,2,3,2,8],[14,2,7.5,4,4,3],[18.5,1.5,7.5,5,3,3],[22.5,1.5,8,3,3,4],[25,1,7.5,2,2,3],[22.5,1,1.5,3,2,9],[19.5,1,-4.5,9,2,3],[-5,12,4,8,4,2],[0,12,3,2,4,6],[6,3,7,12,6,4]].forEach(((e,t)=>{const[n,o,s,i,r,a]=e,l=BABYLON.MeshBuilder.CreateTiledBox(`castle-wall${t}`,{width:i,height:r,depth:a,tileSize:2},this.scene);l.position=new A(n,o,s),l.material=u(!0,.5,this.scene),l.checkCollisions=!0,l.setParent(this.parent);const c=BABYLON.MeshBuilder.CreateTiledBox(`castle-roof${t}`,{width:i-.01,height:.3,depth:a-.01,tileSize:2},this.scene);c.setParent(this.parent),c.position=new A(n,.5*r+o+.15,s),c.material=g(this.scene)})),[[-14,3.5,10,4,7,5],[-14,6,2,1,2,2],[-13.5,6.5,6,.5,1.5,0],[-13.5,6.5,4,.5,1.5,0],[-11.5,6.5,2.5,.5,1.5,0],[-9,10,2,2,3,4],[-9,14,4,1,2,1],[-9,10,6,2,3,4],[-6.5,11.5,2.5,1,3,3],[-3,5,2,4,10,0],[-2,12,3,2,3,1],[-2,10,0,2,3,4],[0,14,0,1,2,1],[2,10,0,2,3,4],[-3,6,-6,1,2,1],[-2.5,7,-3,.5,2,0],[0,7,-5.5,.5,2,0],[3,7,-5.5,.5,2,0],[6,3,-6,4,6,4],[15,5,-6,1,2,2],[21,3,10,1,2,2],[24,1.5,10,2,3,3]].forEach(((e,t)=>{const[n,o,s,r,a,l]=e,c=BABYLON.MeshBuilder.CreateCylinder(`turret${t}`,{height:a,diameter:r},this.scene);if(c.position=new A(n,o,s),c.material=u(!1,a/4,this.scene),c.checkCollisions=!0,c.setParent(this.parent),l){const e=BABYLON.MeshBuilder.CreateCylinder(`turret${t}`,{height:l,diameterBottom:1.1*r,diameterTop:0},this.scene);e.material=f({color1:"#043132",color2:i,scale:40}),e.position=new A(n,o+.5*(a+l),s),e.setParent(this.parent)}}))}}class T{constructor(){this.animations=[],this.scene=null}static get Instance(){return T._instance||(T._instance=new T),T._instance}initScene(e){this.scene||(this.scene=e,this.scene.registerBeforeRender((()=>{const e=Date.now();this.animations=this.animations.filter((t=>{const n=(o=(e-t.startTime)/(t.endTime-t.startTime),0,1,Math.min(Math.max(o,0),1));var o;return e>=t.endTime?(t.end.position&&(t.mesh.position=t.end.position),t.end.rotation&&(t.mesh.rotation=t.end.rotation),t.end.scaling&&(t.mesh.scaling=t.end.scaling),!1):(t.end.position&&(t.mesh.position=BABYLON.Vector3.Lerp(t.start.position,t.end.position,t.easeFunc.ease(n))),t.end.rotation&&(t.mesh.rotation=BABYLON.Vector3.Lerp(t.start.rotation,t.end.rotation,t.easeFunc.ease(n))),t.end.scaling&&(t.mesh.scaling=BABYLON.Vector3.Lerp(t.start.scaling,t.end.scaling,t.easeFunc.ease(n))),!0)}))})))}animateTransform(e){const{mesh:t,end:n}=e,o=e.duration||1e3,s=e.delay||0,i=e.ease||new BABYLON.QuadraticEase,r=Date.now();this.animations.push({mesh:t,start:{position:t.position,rotation:t.rotation,scaling:t.scaling},end:n,easeFunc:i,startTime:r+s,endTime:r+s+o})}}function L(...e){return N.play(...e)}const N={volume:.3,sampleRate:44100,x:new(window.AudioContext||webkitAudioContext),play:function(...e){return this.playSamples(this.buildSamples(...e))},playSamples:function(...e){const t=this.x.createBuffer(e.length,e[0].length,this.sampleRate),n=this.x.createBufferSource();return e.map(((e,n)=>t.getChannelData(n).set(e))),n.buffer=t,n.connect(this.x.destination),n.start(),n},buildSamples:function(e=1,t=.05,n=220,o=0,s=0,i=.1,r=0,a=1,l=0,c=0,h=0,d=0,p=0,u=0,B=0,m=0,g=0,w=1,b=0,v=0){const f=2*Math.PI;let O,A,I=this.sampleRate,T=l*=500*f/I/I,L=n*=(1+2*t*Math.random()-t)*f/I,N=[],M=0,y=0,S=0,Y=1,x=0,C=0,P=0;for(c*=500*f/I**3,B*=f/I,h*=f/I,d*=I,p=p*I|0,A=(o=o*I+9)+(b*=I)+(s*=I)+(i*=I)+(g*=I)|0;S<A;N[S++]=P)++C%(100*m|0)||(P=r?r>1?r>2?r>3?Math.sin((M%f)**3):Math.max(Math.min(Math.tan(M),1),-1):1-(2*M/f%2+2)%2:1-4*Math.abs(Math.round(M/f)-M/f):Math.sin(M),P=(p?1-v+v*Math.sin(f*S/p):1)*(P>0?1:-1)*Math.abs(P)**a*e*this.volume*(S<o?S/o:S<o+b?1-(S-o)/b*(1-w):S<o+b+s?w:S<A-g?(A-S-g)/i*w:0),P=g?P/2+(g>S?0:(S<A-g?1:(A-S)/g)*N[S-g|0]/2):P),O=(n+=l+=c)*Math.cos(B*y++),M+=O-O*u*(1-1e9*(Math.sin(S)+1)%2),Y&&++Y>d&&(n+=h,L+=h,Y=0),!p||++x%p||(n=L,l=T,Y=Y||1);return N},getNote:function(e=0,t=440){return t*2**(e/12)}},M=()=>L(...[2.07,0,130.81,.01,.26,.47,3,1.15,,.1,,,.05,,,,.14,.26,.15,.02]),{TransformNode:y,MeshBuilder:S,Vector3:Y}=BABYLON;let x=0;class C{constructor(e){this.setLines=e=>{this.billboard.material=((e,t)=>{const o=e.join("");if(b[o])return b[o];const[s,r]=c(512);if(r.fillStyle=n,r.fillRect(0,0,s.width,s.height),r.fillStyle=i,r.font="64px Helvetica",r.scale(1,3),r.textBaseline="top",r.textAlign="left",e.length>0){const t=28672/r.measureText(e[0]).width;r.font=`${t}px Helvetica`}e.forEach(((e,t)=>{r.fillText(`${e}`,32,32+72*t)}));const a=m(s,t);return b[o]=a,a})(e,this.scene)},this.scene=e,this.parent=new y("InfoBillboard"+ ++x,e),this.billboard=S.CreatePlane("billboard",{width:3,height:1,sideOrientation:BABYLON.Mesh.DOUBLESIDE},e),this.billboard.setParent(this.parent),this.billboard.position=new Y(0,.6,0),this.billboard.rotation.x=Math.PI/4}set position(e){this.parent.position=e}get model(){return this.parent}}const{TransformNode:P,Vector3:k}=BABYLON;let E=0;const F=["Red cannot be next to","another Red"],R=["Number of flowers must be one","more or less than neighbor"],z=["Square must be placed","in a square shape"];class V{constructor(t,n){this.meshes=[],this.colors={R:"#dc3220",G:e,B:"#1a85ff",Y:"#fefe62",W:o,D:"#994f00"},this.solved=!1,this.scene=n,this.board=t.board,this.solvedEvent=t.solvedEvent,this.boardHeight=this.board.length,this.boardWidth=this.board[0].length,this.parent=new P("FlowerBoxPuzzle",this.scene),this.inventoryTransform=new P("Holding",this.scene);const s=n.getNodeByName("inventory-parent");this.inventoryTransform.setParent(s),this.inventoryTransform.position=k.Zero(),this.inventoryTransform.rotation=k.Zero(),this.selectedMesh=null,this.messageBoard=new C(this.scene),this.messageBoard.setLines([]),this.messageBoard.model.setParent(this.parent),this.messageBoard.model.position=new k(.5*this.boardWidth,0,.5),this.reset()}get model(){return this.parent}set position(e){this.parent.position=e}set scale(e){this.parent.scaling=e}cellAt(e,t,n){try{const o=this.board[t][e];return n&&(this.board[t][e]=n),o}catch{return null}}boardPos(e,t){return new k(1*e+.5,0,-1*t-.5)}groupedCellCount(e,t){const n=[`${e},${t}`],o=this.cellAt(e,t);let s=0;for(let e=0;e<n.length;e++){const[t,i]=n[e].split(","),r=parseInt(t),a=parseInt(i);if(this.cellAt(r,a)===o){s+=1;const e=[`${r+1},${a}`,`${r-1},${a}`,`${r},${a+1}`,`${r},${a-1}`];n.push(...e.filter((e=>!n.includes(e))))}}return s}isSolved(){if(this.solved)return!0;let e=!1;if(this.selectedMesh&&"D"!==this.selectedMesh.metadata.color&&(a&&console.log("RULE - No flowers in hand"),this.messageBoard.setLines([]),e=!0),e)return;let t=0;const n=[];let o=Number.MAX_SAFE_INTEGER,s=-1,i=Number.MAX_SAFE_INTEGER,r=-1;return this.board.forEach(((l,c)=>{e||l.forEach(((l,h)=>{if(e)return;const[d,p,u]=l.split(""),B=[this.cellAt(h+1,c),this.cellAt(h-1,c),this.cellAt(h,c+1),this.cellAt(h,c-1)];"R"===p&&B.some((e=>"R"===e?.split("")[1]))&&(a&&console.log("RULE - Red cannot be next to another Red"),this.messageBoard.setLines(F),e=!0),e||(parseInt(d)>0&&(B.every((e=>{if(!e)return!0;const[t,n,o]=e?.split("");return 0===parseInt(t)||parseInt(d)===parseInt(t)-1||parseInt(d)===parseInt(t)+1}))||(a&&console.log("RULE - Adjacent cells must be 1 or -1 flowers"),this.messageBoard.setLines(R),e=!0)),"C"===u&&(t+=1,o=Math.min(o,h),s=Math.max(s,h),i=Math.min(i,c),r=Math.max(r,c),n.push({x:h,y:c})))}))})),t>0&&t<4&&(a&&console.log("RULE - Cube must have 4 points"),e=!0),n.every(((e,t)=>!(e.x!==o&&e.x!==s||e.y!==i&&e.y!==r)))||(a&&console.log(JSON.stringify(z)),this.messageBoard.setLines(z),e=!0),e||(this.solved=!0),this.solved&&(M(),this.messageBoard.setLines(["COMPLETE"]),this.solvedEvent&&this.solvedEvent()),this.solved}swapMesh(e){const t=e.metadata||{},{x:n,y:o}=t,s=this.selectedMesh?`${this.selectedMesh.metadata.count}${this.selectedMesh.metadata.color}${this.selectedMesh.metadata.shape}`:"";this.cellAt(n,o,s),this.selectedMesh&&(this.selectedMesh.metadata={...this.selectedMesh.metadata,picked:!1,x:n,y:o},this.placeFlower(this.selectedMesh),this.selectedMesh=null),e.metadata={...e.metadata,picked:!0},this.selectedMesh=e,this.placeFlower(this.selectedMesh),this.isSolved()}createFlower(t,n,o,s,i){const r=new BABYLON.Mesh("flower",this.scene);r.metadata={count:t,color:n,shape:o,x:s,y:i},r.onPointerPick=()=>{L(...[1.01,,275,.01,.01,.15,1,1.03,-3.7,,-93,.07,,,,-.1,,.5,.04,.09]),this.solved||this.swapMesh(r)};for(let s=0;s<t;s++){const i=BABYLON.MeshBuilder.CreateCylinder("stem"+ ++E,{height:.4,diameter:.1},this.scene);let a;i.setParent(r),i.position.y=.2,a="T"===o?BABYLON.MeshBuilder.CreateCylinder("head"+ ++E,{diameterBottom:0,diameterTop:.4,height:.4,tessellation:3},this.scene):"S"===o?BABYLON.MeshBuilder.CreateSphere("head"+ ++E,{diameter:.3},this.scene):BABYLON.MeshBuilder.CreateBox("head"+ ++E,{size:.25},this.scene),a.setParent(i),a.position=new k(0,.3,0),a.material=B(this.colors[n],this.scene),i.position=new k(0,.2,0),t>1&&i.rotateAround(k.Zero(),k.Right(),Math.PI/8),i.rotateAround(k.Zero(),k.Up(),2*s*Math.PI/t),i.material=B(e,this.scene)}const a=BABYLON.MeshBuilder.CreateCylinder("leaf",{diameter:.3,height:.1},this.scene);return a.setParent(r),a.position=new k(.15,.15,0),a.material=B(e,this.scene),r}createBush(){const n=new BABYLON.Mesh("bush",this.scene),o=BABYLON.MeshBuilder.CreateBox("head",{height:.2,width:.9,depth:.9},this.scene);return o.setParent(n),o.position=new k(0,.1,0),o.material=f({color1:e,color2:t,scale:100}),n}createEmpty(e,t){const n=new BABYLON.Mesh("empty",this.scene);n.onPointerPick=()=>{this.solved||this.swapMesh(n)},n.metadata={count:1,color:"D",shape:"",x:e,y:t};const o=BABYLON.MeshBuilder.CreateBox("head",{height:.2,width:.4,depth:.4},this.scene);return o.setParent(n),o.position=new k(0,.1,0),o.material=B(this.colors.D,this.scene),n}placeFlower(e){if(e.metadata.picked)return e.setParent(this.inventoryTransform),T.Instance.animateTransform({mesh:e,end:{position:k.Zero(),rotation:k.Zero(),scaling:new k(.25,.25,.25)},duration:200}),e.renderingGroupId=1,e.isPickable=!1,void e.setEnabled("D"!==e.metadata.color);const{x:t,y:n}=e.metadata;e.setParent(this.parent),T.Instance.animateTransform({mesh:e,end:{position:this.boardPos(t,n),rotation:k.Zero(),scaling:k.One()},duration:200}),e.isPickable=!0,e.setEnabled(!0),e.renderingGroupId=0}reset(){this.meshes.forEach((e=>{e.dispose()})),this.selectedMesh=null;const n=BABYLON.MeshBuilder.CreateGround("flower-puzzle-ground",{width:this.boardWidth,height:this.boardHeight});n.material=((e,t,n,o,s)=>{const[i,r]=c(512);r.imageSmoothingEnabled=!1;const a=512/n,l=512/o;r.fillStyle=e,r.fillRect(0,0,i.width,i.height),r.fillStyle=t;for(let e=0;e<o;e++)for(let t=0;t<n;t++)(t+e)%2||r.fillRect(t*a,e*l,a,l);const u=new h("material"+ ++p,s),B=d.LoadFromDataString("texture"+ ++p,i.toDataURL(),s);return u.diffuseTexture=B,u})(e,t,this.boardWidth,this.boardHeight,this.scene),n.setParent(this.parent),n.position=new k(.5*this.boardWidth,.02,-.5*this.boardHeight);for(let e=-1;e<this.boardHeight+1;e++)for(let t=-1;t<this.boardWidth+1;t++){if(e>=0&&e<this.boardHeight&&t>=0&&t<this.boardWidth)continue;const n=this.createBush();n.setParent(this.parent),n.name=`bush${t},${e}`,n.position=this.boardPos(t,e)}this.board.forEach(((e,t)=>{e.forEach(((e,n)=>{let o;const[s,i,r]=e.split("");switch(i){case"":return;case"R":case"Y":case"B":case"W":o=this.createFlower(parseInt(s),i,r,n,t),o.name=`cell${n}-${t}`,this.placeFlower(o)}}))})),this.selectedMesh=this.createEmpty(-1,-1),this.selectedMesh.metadata={...this.selectedMesh.metadata,picked:!0},this.placeFlower(this.selectedMesh),this.solved=!1}}const D=function(e){const t=e.baseColor?BABYLON.Color4.FromHexString(`${e.baseColor}FF`):BABYLON.Color4.FromHexString("#243DA6FF"),n=e.rippleColor?BABYLON.Color4.FromHexString(`${e.rippleColor}FF`):BABYLON.Color4.FromHexString("#0AD6E0FF"),o=e.frozen||!1,s=new BABYLON.NodeMaterial("node"),i=new BABYLON.InputBlock("position");i.visibleInInspector=!1,i.visibleOnFrame=!1,i.target=1,i.setAsAttribute("position");const r=new BABYLON.TransformBlock("WorldPos");r.visibleInInspector=!1,r.visibleOnFrame=!1,r.target=1,r.complementZ=0,r.complementW=1;const a=new BABYLON.InputBlock("World");a.visibleInInspector=!1,a.visibleOnFrame=!1,a.target=1,a.setAsSystemValue(BABYLON.NodeMaterialSystemValues.World);const l=new BABYLON.TransformBlock("WorldPos * ViewProjectionTransform");l.visibleInInspector=!1,l.visibleOnFrame=!1,l.target=1,l.complementZ=0,l.complementW=1;const c=new BABYLON.InputBlock("ViewProjection");c.visibleInInspector=!1,c.visibleOnFrame=!1,c.target=1,c.setAsSystemValue(BABYLON.NodeMaterialSystemValues.ViewProjection);const h=new BABYLON.VertexOutputBlock("VertexOutput");h.visibleInInspector=!1,h.visibleOnFrame=!1,h.target=1;const d=new BABYLON.InputBlock("TwirlCenter");d.visibleInInspector=!1,d.visibleOnFrame=!1,d.target=1,d.value=new BABYLON.Vector2(.5,.5),d.isConstant=!1;const p=new BABYLON.VectorSplitterBlock("VectorSplitter");p.visibleInInspector=!1,p.visibleOnFrame=!1,p.target=4;const u=new BABYLON.AddBlock("Add");u.visibleInInspector=!1,u.visibleOnFrame=!1,u.target=1;const B=new BABYLON.VectorMergerBlock("VectorMerger");B.visibleInInspector=!1,B.visibleOnFrame=!1,B.target=1,B.xSwizzle="x",B.ySwizzle="y",B.zSwizzle="z",B.wSwizzle="w";const m=new BABYLON.SubtractBlock("Subtract (x)");m.visibleInInspector=!1,m.visibleOnFrame=!1,m.target=1;const g=new BABYLON.MultiplyBlock("Multiply");g.visibleInInspector=!1,g.visibleOnFrame=!1,g.target=1;const w=new BABYLON.TrigonometryBlock("Cos");w.visibleInInspector=!1,w.visibleOnFrame=!1,w.target=4,w.operation=BABYLON.TrigonometryBlockOperations.Cos;const b=new BABYLON.MultiplyBlock("Strength x Delta Lergth");b.visibleInInspector=!1,b.visibleOnFrame=!1,b.target=1;const v=new BABYLON.InputBlock("TwirlStrength");v.visibleInInspector=!1,v.visibleOnFrame=!1,v.target=1,v.value=2,v.min=0,v.max=0,v.isBoolean=!1,v.matrixMode=0,v.animationType=BABYLON.AnimatedInputBlockTypes.None,v.isConstant=!1;const f=new BABYLON.LengthBlock("Delta (Length)");f.visibleInInspector=!1,f.visibleOnFrame=!1,f.target=1;const O=new BABYLON.SubtractBlock("Delta (Subtract)");O.visibleInInspector=!1,O.visibleOnFrame=!1,O.target=1;const A=new BABYLON.InputBlock("uv");A.visibleInInspector=!1,A.visibleOnFrame=!1,A.target=1,A.setAsAttribute("uv");const I=new BABYLON.VectorSplitterBlock("VectorSplitter");I.visibleInInspector=!1,I.visibleOnFrame=!1,I.target=1;const T=new BABYLON.MultiplyBlock("Multiply");T.visibleInInspector=!1,T.visibleOnFrame=!1,T.target=1;const L=new BABYLON.TrigonometryBlock("Sin");L.visibleInInspector=!1,L.visibleOnFrame=!1,L.target=1,L.operation=BABYLON.TrigonometryBlockOperations.Sin;const N=new BABYLON.AddBlock("Add (y)");N.visibleInInspector=!1,N.visibleOnFrame=!1,N.target=1;const M=new BABYLON.MultiplyBlock("Multiply");M.visibleInInspector=!1,M.visibleOnFrame=!1,M.target=1;const y=new BABYLON.TrigonometryBlock("Cos");y.visibleInInspector=!1,y.visibleOnFrame=!1,y.target=1,y.operation=BABYLON.TrigonometryBlockOperations.Cos;const S=new BABYLON.MultiplyBlock("Multiply");S.visibleInInspector=!1,S.visibleOnFrame=!1,S.target=1;const Y=new BABYLON.TrigonometryBlock("Sin");Y.visibleInInspector=!1,Y.visibleOnFrame=!1,Y.target=4,Y.operation=BABYLON.TrigonometryBlockOperations.Sin;const x=new BABYLON.VoronoiNoiseBlock("VoronoiNoise");x.visibleInInspector=!1,x.visibleOnFrame=!1,x.target=4;const C=new BABYLON.AddBlock("Add");C.visibleInInspector=!1,C.visibleOnFrame=!1,C.target=4;const P=new BABYLON.InputBlock("Time");P.visibleInInspector=!1,P.visibleOnFrame=!1,P.target=1,P.value=0,P.min=0,P.max=0,P.isBoolean=!1,P.matrixMode=0,P.animationType=o?BABYLON.AnimatedInputBlockTypes.None:BABYLON.AnimatedInputBlockTypes.Time,P.isConstant=o;const k=new BABYLON.InputBlock("Offset");k.visibleInInspector=!1,k.visibleOnFrame=!1,k.target=1,k.value=666,k.min=0,k.max=0,k.isBoolean=!1,k.matrixMode=0,k.animationType=BABYLON.AnimatedInputBlockTypes.None,k.isConstant=!0;const E=new BABYLON.InputBlock("Scale");E.visibleInInspector=!1,E.visibleOnFrame=!1,E.target=1,E.value=12,E.min=0,E.max=0,E.isBoolean=!1,E.matrixMode=0,E.animationType=BABYLON.AnimatedInputBlockTypes.None,E.isConstant=!1;const F=new BABYLON.ColorMergerBlock("ColorMerger");F.visibleInInspector=!1,F.visibleOnFrame=!1,F.target=4,F.rSwizzle="r",F.gSwizzle="g",F.bSwizzle="b",F.aSwizzle="a";const R=new BABYLON.InputBlock("ColorAlpha");R.visibleInInspector=!1,R.visibleOnFrame=!1,R.target=1,R.value=1,R.min=0,R.max=0,R.isBoolean=!1,R.matrixMode=0,R.animationType=BABYLON.AnimatedInputBlockTypes.None,R.isConstant=!0;const z=new BABYLON.MultiplyBlock("Multiply");z.visibleInInspector=!1,z.visibleOnFrame=!1,z.target=4;const V=new BABYLON.InputBlock("RippleColor");V.visibleInInspector=!1,V.visibleOnFrame=!1,V.target=1,V.value=n,V.isConstant=!1;const D=new BABYLON.MaxBlock("Max");D.visibleInInspector=!1,D.visibleOnFrame=!1,D.target=4;const W=new BABYLON.InputBlock("BaseColor");W.visibleInInspector=!1,W.visibleOnFrame=!1,W.target=1,W.value=t,W.isConstant=!1;const $=new BABYLON.FragmentOutputBlock("FragmentOutput");$.visibleInInspector=!1,$.visibleOnFrame=!1,$.target=2,$.convertToGammaSpace=!1,$.convertToLinearSpace=!1,$.useLogarithmicDepth=!1;const G=new BABYLON.InputBlock("Opacity");return G.visibleInInspector=!1,G.visibleOnFrame=!1,G.target=1,G.value=1,G.min=0,G.max=0,G.isBoolean=!1,G.matrixMode=0,G.animationType=BABYLON.AnimatedInputBlockTypes.None,G.isConstant=!1,i.output.connectTo(r.vector),a.output.connectTo(r.transform),r.output.connectTo(l.vector),c.output.connectTo(l.transform),l.output.connectTo(h.vector),d.output.connectTo(p.xyIn),p.xyOut.connectTo(u.left),v.output.connectTo(b.left),A.output.connectTo(O.left),p.xyOut.connectTo(O.right),O.output.connectTo(f.value),f.output.connectTo(b.right),b.output.connectTo(w.input),w.output.connectTo(g.left),O.output.connectTo(I.xyIn),I.x.connectTo(g.right),g.output.connectTo(m.left),b.output.connectTo(Y.input),Y.output.connectTo(S.left),I.y.connectTo(S.right),S.output.connectTo(m.right),m.output.connectTo(B.x),I.x.connectTo(T.left),b.output.connectTo(L.input),L.output.connectTo(T.right),T.output.connectTo(N.left),b.output.connectTo(y.input),y.output.connectTo(M.left),I.y.connectTo(M.right),M.output.connectTo(N.right),N.output.connectTo(B.y),B.xy.connectTo(u.right),u.output.connectTo(x.seed),P.output.connectTo(C.left),k.output.connectTo(C.right),C.output.connectTo(x.offset),E.output.connectTo(x.density),x.output.connectTo(F.r),x.output.connectTo(F.g),x.output.connectTo(F.b),R.output.connectTo(F.a),F.rgba.connectTo(z.left),V.output.connectTo(z.right),z.output.connectTo(D.left),W.output.connectTo(D.right),D.output.connectTo($.rgba),G.output.connectTo($.a),s.addOutputNode(h),s.addOutputNode($),s.build(),s},{TransformNode:W,Vector3:$,MeshBuilder:G}=BABYLON;class U{constructor(e){this.solved=!1,this.solvedCount=0,this.scene=e,this.puzzles=[],this.floors=[],this.parent=new W("Garden",this.scene),this.endgameSphere=null,this.reset()}get model(){return this.parent}set position(e){this.parent.position=e}set scale(e){this.parent.scaling=e}isSolved(){if(this.solved)return!0;this.solvedCount=0;for(let e=0;e<this.puzzles.length;e++)this.puzzles[e].solved&&(this.solvedCount+=1);if(this.solved=this.puzzles.length>0&&this.solvedCount===this.puzzles.length,this.solved){if(!this.endgameSphere)return;this.endgameSphere.setEnabled(!0),this.endgameSphere.scaling=$.Zero(),T.Instance.animateTransform({mesh:this.endgameSphere,end:{scaling:new $(1,1,1)},ease:new BABYLON.ExponentialEase(2),duration:1e3})}return this.solved}reset(){this.floors=[];const e=G.CreateTiledGround("Garden-ground",{xmin:-18,xmax:18,zmin:-6,zmax:10,subdivisions:{h:12,w:24}},this.scene);e.material=(e=>{const[t,n]=c(256);n.fillStyle="#6d4d41",n.fillRect(0,0,t.width,t.height),n.fillStyle="#49332b";for(let e=0;e<12;e++){const e=Math.random()*(t.width-12),o=Math.random()*(t.height-12);n.fillRect(e,o,12,12)}return m(t,e)})(this.scene),e.setParent(this.parent),e.position=new $(0,.01,0),this.floors.push(e),G.CreateTorus("fountain-edge",{diameter:4,thickness:1,tessellation:32},this.scene).setParent(this.parent);const t=G.CreateCylinder("fountain-water",{diameter:4,height:1,tessellation:32});t.material=D({}),t.checkCollisions=!0,t.setParent(this.parent);const n=G.CreateTorusKnot("fountain-statue",{tube:.1,radialSegments:128,p:5,q:2},this.scene);n.setParent(this.parent);const o=new $(0,1.5,0);n.position=o,n.rotation.x=Math.PI/2,n.scaling=new $(.5,.5,1.5),n.registerBeforeRender((e=>{this.solvedCount>0&&e.rotateAround(o,$.Up(),Math.PI/1700*this.scene.getEngine().getDeltaTime()),this.solvedCount>1&&e.rotateAround(o,$.Right(),Math.PI/800*this.scene.getEngine().getDeltaTime()),this.solvedCount>2&&e.rotateAround(o,$.Forward(),Math.PI/500*this.scene.getEngine().getDeltaTime())})),this.endgameSphere=G.CreateSphere("endgame-sphere",{diameter:1,sideOrientation:BABYLON.Mesh.DOUBLESIDE},this.scene),this.endgameSphere.material=B(i,this.scene),this.endgameSphere.renderingGroupId=1,this.endgameSphere.setParent(this.parent),this.endgameSphere.position.y=1.5,this.endgameSphere.onPointerPick=()=>{T.Instance.animateTransform({mesh:this.endgameSphere,end:{scaling:new $(100,100,100)},ease:new BABYLON.ExponentialEase(2),duration:1e4})},this.endgameSphere.setEnabled(!1);const s=[[["1RT","1RT"],["2BT","2BT"]],[["0ET","2RC","0ET","0ET","1BS"],["2RC","0ET","1BS","0ET","0ET"],["0ET","2RC","0ET","1BS","0ET"],["2RC","0ET","1BS","0ET","1BS"],["0ET","1BS","0ET","0ET","0ET"]],[["3YT"],["1YT"],["1YT"],["2YT"],["2YT"]],[["0ET","0ET","3BS","0ET","0ET"],["0ET","2RS","3BC","3BS","0ET"],["2RS","2BS","1RC","3BC","1BS"],["0ET","1RS","3BS","1BC","0ET"],["0ET","0ET","2BS","0ET","0ET"]]],r=[new $(-15,0,6),new $(-9,0,2),new $(4,0,2),new $(9,0,5)];for(let e=0;e<s.length;e++){const t=r[e],n=new V({board:s[e],solvedEvent:()=>{this.isSolved()}},this.scene);n.model.setParent(this.parent),n.position=t,n.isSolved(),this.puzzles.push(n)}this.solved=!1}}const{TransformNode:H,MeshBuilder:Z,Vector3:_}=BABYLON;let j=0;const{TransformNode:X,Vector3:q}=BABYLON;class K{constructor(e,t){this.solved=!1,this.updateDials=()=>{this.dials.forEach((e=>{const t=parseInt(e.metadata.alphabetIndex,10),n=2*Math.PI/this.alphabet.length,o=.5*Math.PI+.5*n+t*n;T.Instance.animateTransform({mesh:e,end:{rotation:new q(0,o,0)},duration:60})}))},this.scene=t,this.alphabet=e.alphabet?.split("")||Array.from("0123456789"),this.code=e.code?.split("")||Array.from("123"),this.guess=Array.from(this.alphabet[0].repeat(this.code.length)),this.parent=new X("DialPuzzle",this.scene),this.parent.position=q.Zero(),this.dials=[],this.solvedEvent=e.solvedEvent?e.solvedEvent:()=>{},this.reset()}get model(){return this.parent}set scale(e){this.parent.scaling=e}isSolved(){return!!this.solved||(this.solved=this.code.every(((e,t)=>this.guess[t]===e)),this.solved&&(M(),this.solvedEvent()),this.solved)}reset(){this.solved=!1,this.dials=[];const e=this.code.length,t=1*Math.sin(Math.PI/this.alphabet.length);for(let n=0;n<e;n++){const o=[];o[0]=new BABYLON.Vector4(0,0,0,0),o[1]=new BABYLON.Vector4(1,0,0,1),o[2]=new BABYLON.Vector4(0,0,0,0);const s=BABYLON.MeshBuilder.CreateCylinder(`dial-${n}`,{height:t,diameter:1,faceUV:o,tessellation:this.alphabet.length},this.scene);s.onPointerPick=()=>{if(L(...[,,76,.02,.02,.01,1,.44,,,,,,.5,,,,,.01,.57]),this.solved)return;const{index:e,alphabetIndex:t}=s.metadata,o=t+1;s.metadata={index:n,alphabetIndex:o},this.guess[e]=this.alphabet[o%this.alphabet.length],this.updateDials(),this.isSolved()},s.setParent(this.parent),s.position=new q(0,(e-n-1)*(t+.05)+.15,0),s.material=w(this.alphabet,this.scene),s.metadata={index:n,alphabetIndex:0},this.dials.push(s)}const n=BABYLON.MeshBuilder.CreateBox("dial-align",{height:(t+.05)*(e+1),width:.2,depth:.2});n.setParent(this.parent),n.position=new q(0,.15*e,-.26),n.material=B(r,this.scene);const o=BABYLON.MeshBuilder.CreatePlane("dial-banner",{},this.scene);o.setParent(this.parent),o.position=new q(0,.15*e+2,-.26),o.material=v(this.scene),this.updateDials()}}const{TransformNode:J,MeshBuilder:Q,Vector3:ee}=BABYLON;let te=0;const{TransformNode:ne,MeshBuilder:oe,Vector3:se}=BABYLON;let ie=0;const re=e=>{const t=new ne("Banner"+ ++ie,e),n=oe.CreateGround("symbols",{width:4,height:4,subdivisions:12,updatable:!0},e);n.setParent(t),n.position=new se(0,2,0),n.rotation.x=3*Math.PI/2,n.material=v(e);let o=0;return n.registerBeforeRender((t=>{o+=e.getEngine().getDeltaTime();const n=t.getVerticesData(BABYLON.VertexBuffer.PositionKind);if(n){for(let e=0;e<n?.length;e+=3)n[e+1]=.1*(n[e+2]-2)*Math.sin(.8*o/100+n[e+2]);t.updateVerticesData(BABYLON.VertexBuffer.PositionKind,n)}})),t},{TransformNode:ae,MeshBuilder:le,Vector3:ce}=BABYLON;let he=0;const{MeshBuilder:de,TransformNode:pe,Vector3:ue}=BABYLON;class Be{constructor(e){this.solved=!1,this.scene=e,this.puzzles=[],this.floors=[],this.bushes=[],this.trees=[],this.parent=new pe("Entrance",this.scene),this.reset()}get model(){return this.parent}set position(e){this.parent.position=e}set scale(e){this.parent.scaling=e}isSolved(){return!!this.solved||(this.solved=this.puzzles.length>0&&this.puzzles.every((e=>e.solved)),this.solved&&(this.bushes.forEach(((e,t)=>{e.position.z<-14||e.position.z>-12||T.Instance.animateTransform({mesh:e,end:{position:e.position.add(new ue(0,3,0))},duration:4e3,delay:3e3})})),this.door&&T.Instance.animateTransform({mesh:this.door,end:{rotation:this.door.rotation.add(new ue(-1*Math.PI/2,0,0))},duration:5e3})),this.solved)}reset(){this.floors=[];const e=de.CreateTiledGround("ground",{xmin:-10,xmax:12,zmin:-20,zmax:12,subdivisions:{w:11,h:16}});e.setParent(this.parent),e.material=g(this.scene),e.position.y=-.01,e.position=new ue(0,.01,0);const t=[{shape:"box",count:3},{shape:"sphere",count:5},{shape:"triangle",count:4}];t.forEach(((e,t)=>{const n=((e,t)=>{const n=new H("Tree"+ ++j,t),o=e.count||3,s=e.shape||"box",i=Z.CreateCylinder("trunk"+ ++j,{diameter:.5,height:3,tessellation:6});i.material=f({color1:"#332211",color2:"#593b1d",scale:5}),i.setParent(n),i.position=new _(0,1.5,0);for(let e=0;e<o;e++){let n;switch(s){case"box":n=Z.CreateBox("shape"+ ++j,{size:1.5},t);break;case"triangle":n=Z.CreateCylinder("shape"+ ++j,{diameterTop:0,diameterBottom:4,tessellation:3},t);break;case"sphere":n=Z.CreateSphere("shape"+ ++j,{diameter:2},t)}if(!n)return;n.material=f({color1:"#00ff00",color2:"#332211",scale:25}),n.setParent(i),n.position.y=.75*e+.5,n.position.x=.25*(o-e),n.rotation=new _(2*Math.random()*Math.PI,2*Math.random()*Math.PI,2*Math.random()*Math.PI),n.rotateAround(_.Zero(),_.Up(),2*Math.random()*Math.PI)}return n})(e,this.scene);n&&(n.setParent(this.parent),n.position=new ue(0,0,-4*t+4),this.trees.push(n))}));const o=new K({code:t.map((e=>e.count)).join(""),alphabet:"012345",solvedEvent:()=>{this.isSolved()}},this.scene);o.model.setParent(this.parent),o.model.position=new ue(7.5,.5,11.5),o.model.rotation=new ue(0,Math.PI/4,0),this.puzzles.push(o);const s=(e=>{const t=new J("Door"+ ++te,e),o=[new ee(2,0,0),new ee(2,2,0),new ee(1.74,3,0),new ee(1,3.74,0),new ee(0,4,0),new ee(-1,3.74,0),new ee(-1.74,3,0),new ee(-2,2,0),new ee(-2,0,0)],s=[new ee(0,0,.5),new ee(0,0,-.5)],i=[new ee(.51,-.1,0),new ee(.51,0,0),new ee(-.51,0,0),new ee(-.51,-.1,0)],a=[new ee(0,0,0),new ee(0,4,0)],l=[new ee(.1,0,0),new ee(.2,0,0),new ee(.2,.05,0),new ee(.1,.05,0)],c=[new ee(1,.5,0),new ee(0,.5,0),new ee(0,1,0),new ee(-1,0,0),new ee(0,-1,0),new ee(0,-.5,0),new ee(1,-.5,0)],h=Q.ExtrudeShape("door",{shape:o,path:s,closeShape:!0,cap:BABYLON.Mesh.CAP_ALL},e);h.material=f({color1:"#332211",color2:"#593b1d",scale:5}),h.setParent(t);const d=Q.ExtrudeShape("frame",{shape:i,path:o,closeShape:!0,cap:BABYLON.Mesh.CAP_ALL},e);d.material=B("#888888",e),d.setParent(t);const p=Q.ExtrudeShape("frame",{shape:i,path:a,closeShape:!0,cap:BABYLON.Mesh.CAP_ALL},e);p.material=B("#000000",e),p.setParent(t);const u=BABYLON.MeshBuilder.CreateLathe("handle",{shape:l,radius:1,closed:!0,tessellation:12,sideOrientation:BABYLON.Mesh.DOUBLESIDE},e);u.material=B("#000000",e),u.setParent(t),u.rotation.x=Math.PI/2,u.position=new ee(-.5,1,-.55),u.clone("handle2").position.x*=-1;const m=Q.ExtrudeShape("door",{shape:c,path:s,closeShape:!0,cap:BABYLON.Mesh.CAP_ALL},e);return m.setParent(t),m.position=new ee(0,1,-1),m.material=D({baseColor:r,rippleColor:n}),m.rotateAround(new ee(0,0,-1),ee.Up(),Math.PI/4),m.rotateAround(new ee(0,0,1),ee.Right(),Math.PI/2),t})(this.scene);s.setParent(this.parent),s.position=new ue(9.5,0,9.5),s.rotation=new ue(0,Math.PI/4,0),this.door=s;const i=re(this.scene);i.setParent(this.parent),i.position=new ue(-5,8,11.5);const l=re(this.scene);l.setParent(this.parent),l.position=new ue(11.6,8,0),l.rotation=new ue(0,Math.PI/2,0),this.floors.push(e);const c=(e=>{const t=new ae("Door"+ ++he,e),n=le.CreateBox("Bush"+ ++he,{width:.95,depth:.95,height:3},e);return n.setParent(t),n.position=new ce(0,1.5,0),n.material=f({color1:"#00ff00",color2:"#ff00ff",scale:60}),n.checkCollisions=!0,t})(this.scene);for(let e=0;e<16;e++){const t=c.clone(`Bush${e}`,this.parent,!1);t&&(t.position=new ue(12.5,0,-19.5+e),this.bushes.push(t),a&&t.setEnabled(!1))}c.dispose(),this.solved=!1}}const{Engine:me,Scene:ge,MeshBuilder:we,HemisphericLight:be,UniversalCamera:ve,Vector3:fe,PointerEventTypes:Oe}=BABYLON,Ae=async()=>{let e=!1;document.getElementById("intro").style.display="none";const t=document.getElementById("c");t.style.display="block",t.addEventListener("click",(async()=>{document.pointerLockElement!==t&&await t.requestPointerLock({unadjustedMovement:!0})}));const n=new me(t,!0),s=new ge(n);T.Instance.initScene(s),s.gravity=new fe(0,-.15,0),s.collisionsEnabled=!0,a&&s.debugLayer.show({embedMode:!0}),n.displayLoadingUI();const h=new ve("MainCamera",new fe(-23,1.615,13.5),s);h.inertia=0,h.speed=3,h.keysUp.push(87),h.keysDown.push(83),h.keysLeft.push(65),h.keysRight.push(68),h.keysUpward.push(69),h.keysDownward.push(81),h.attachControl(t,!0),h.angularSensibility=500,h.applyGravity=!0,h.ellipsoid=new fe(.4,.8,.4),h.checkCollisions=!0,h.minZ=.1,s.onPointerObservable.add((t=>{if(t.type!==Oe.POINTERDOWN)return;if(!s)return;if(!e&&0!==t.event.button)return;const o=e?t.pickInfo:s.pick(n.getRenderWidth()/2,n.getRenderHeight()/2);let i=o?.pickedMesh;for(;i&&!i.onPointerPick;)i=i.parent;i&&i.onPointerPick&&i.onPointerPick()})),n.runRenderLoop((()=>{s.render()})),window.addEventListener("resize",(()=>{n.resize()}));const d=new BABYLON.TransformNode("inventory-parent",s);d.setParent(s.activeCamera),d.position=new fe(-.5,0,2);const p=BABYLON.MeshBuilder.CreatePlane("cursor",{},s);p.isPickable=!1,p.material=(e=>{const[t,n]=c(512);n.imageSmoothingEnabled=!1,n.lineCap="round",n.beginPath(),n.moveTo(250,256),n.lineTo(262,256),n.moveTo(256,250),n.lineTo(256,262),n.lineWidth=2,n.strokeStyle=i,n.stroke(),n.lineWidth=1.5,n.strokeStyle=o,n.stroke();const s=m(t,e);return s.disableLighting=!0,s.emissiveColor=BABYLON.Color3.White(),s.diffuseTexture.hasAlpha=!0,s})(s),p.setParent(h),p.position=new fe(0,0,1.1),p.renderingGroupId=1,new be("light",new fe(-.5,1,0),s);const u=new be("light",new fe(.5,-1,0),s),B=BABYLON.MeshBuilder.CreateSphere("skybox",{diameter:200,sideOrientation:BABYLON.Mesh.DOUBLESIDE},s),g=f({color1:r,color2:o,scale:.1});B.material=g,B.infiniteDistance=!0,u.includedOnlyMeshes.push(B);const w=we.CreateTiledGround("ground",{xmin:-50,xmax:100,zmin:-20,zmax:80,subdivisions:{w:20,h:10}});w.material=(e=>{const[t,n]=c(512),[o,s]=c(2*t.width),i=t.width/32;s.save();const r=["#abb348","#7ca244","#426d38","#799c45","#a7af48"],a=[];for(let e=0;e<32;e++)for(let t=0;t<32;t++)a.push({x:t,y:e});const h=(e=>{for(let t=e.length-1;t>1;t--){const n=Math.floor(Math.random()*t),o=e[t];e[t]=e[n],e[n]=o}return e})(a);return s.translate(.25*o.width,.25*o.height),h.forEach((e=>{const{x:t,y:n}=e;s.save(),s.fillStyle=l(r),s.translate(t*i,n*i);const a=1*Math.random()+1,c=Math.random()*Math.PI;s.save(),s.scale(a,a),s.rotate(c),s.fillRect(-.5*i,-.5*i,i,i),s.restore(),0==t&&(s.save(),s.translate(.5*o.width,0),s.save(),s.scale(a,a),s.rotate(c),s.fillRect(-.5*i,-.5*i,i,i),s.restore(),s.restore()),0==n&&(s.save(),s.translate(0,.5*o.height),s.save(),s.scale(a,a),s.rotate(c),s.fillRect(-.5*i,-.5*i,i,i),s.restore(),s.restore()),s.restore()})),s.restore(),n.drawImage(o,.25*o.width,.25*o.height,.5*o.width,.5*o.height,0,0,t.width,t.height),m(t,e)})(s),w.checkCollisions=!0,w.position.y=-.01;const b=new Be(s);b.position=new fe(-15,0,32);const v=new I(s);v.position=new fe(3,0,40),v.scale=new fe(2,2,2),h.setTarget(new fe(-1,10,43));const O=new U(s);O.position=new fe(15,0,18);const A=we.CreateBox("bounds",{width:58,height:5,depth:32,sideOrientation:BABYLON.Mesh.BACKSIDE},s);A.position=new fe(4,0,28),A.checkCollisions=!0,A.visibility=0,n.hideLoadingUI();const L=await s.createDefaultXRExperienceAsync({floorMeshes:[...b.floors,...O.floors]});L.input.onControllerAddedObservable.add((e=>{e.onMotionControllerInitObservable.add((e=>{e.onModelLoadedObservable.add((e=>{d.setParent(e.rootMesh),d.position=new fe(0,.1,.1),d.rotation=fe.Zero()}))}))})),L.input.onControllerRemovedObservable.add(((e,t)=>{d.setParent(s.activeCamera),d.position=new fe(-.5,0,2),d.rotation=fe.Zero()})),L.baseExperience.onStateChangedObservable.add((t=>{e=t===BABYLON.WebXRState.IN_XR,p.isEnabled(!e),a&&console.log("inXRMode",e,L.input.controllers),e||(d.setParent(s.activeCamera),d.position=new fe(-.5,0,2),d.rotation=fe.Zero())}))};window.addEventListener("DOMContentLoaded",(()=>{document.getElementById("playButton").onclick=Ae}))})();